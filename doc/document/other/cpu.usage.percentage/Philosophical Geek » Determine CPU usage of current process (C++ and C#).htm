<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head 
profile="http://gmpg.org/xfn/11">



	<title>Philosophical Geek » Determine CPU usage of current process (C++
 and C#)</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="generator" content="WordPress 2.9.2"> <!-- leave this for stats please -->
	<meta name="verify-v1" 
content="oH65SLD9xydQ7iukGLJH7tmPrBxk2beDkiZ3iFmDooE=">

	<link rel="stylesheet" 
href="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/style_002.css"
 type="text/css" media="screen">
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" 
href="http://www.philosophicalgeek.com/feed/">
	<link rel="alternate" type="text/xml" title="RSS .92" 
href="http://www.philosophicalgeek.com/feed/rss/">
	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" 
href="http://www.philosophicalgeek.com/feed/atom/">
	<link rel="pingback" href="http://www.philosophicalgeek.com/xmlrpc.php">

		<link rel="archives" title="May 2010" 
href="http://www.philosophicalgeek.com/2010/05/">
	<link rel="archives" title="March 2010" 
href="http://www.philosophicalgeek.com/2010/03/">
	<link rel="archives" title="November 2009" 
href="http://www.philosophicalgeek.com/2009/11/">
	<link rel="archives" title="October 2009" 
href="http://www.philosophicalgeek.com/2009/10/">
	<link rel="archives" title="August 2009" 
href="http://www.philosophicalgeek.com/2009/08/">
	<link rel="archives" title="July 2009" 
href="http://www.philosophicalgeek.com/2009/07/">
	<link rel="archives" title="June 2009" 
href="http://www.philosophicalgeek.com/2009/06/">
	<link rel="archives" title="February 2009" 
href="http://www.philosophicalgeek.com/2009/02/">
	<link rel="archives" title="January 2009" 
href="http://www.philosophicalgeek.com/2009/01/">
	<link rel="archives" title="December 2008" 
href="http://www.philosophicalgeek.com/2008/12/">
	<link rel="archives" title="November 2008" 
href="http://www.philosophicalgeek.com/2008/11/">
	<link rel="archives" title="October 2008" 
href="http://www.philosophicalgeek.com/2008/10/">
	<link rel="archives" title="September 2008" 
href="http://www.philosophicalgeek.com/2008/09/">
	<link rel="archives" title="August 2008" 
href="http://www.philosophicalgeek.com/2008/08/">
	<link rel="archives" title="July 2008" 
href="http://www.philosophicalgeek.com/2008/07/">
	<link rel="archives" title="June 2008" 
href="http://www.philosophicalgeek.com/2008/06/">
	<link rel="archives" title="May 2008" 
href="http://www.philosophicalgeek.com/2008/05/">
	<link rel="archives" title="April 2008" 
href="http://www.philosophicalgeek.com/2008/04/">
	<link rel="archives" title="March 2008" 
href="http://www.philosophicalgeek.com/2008/03/">
	<link rel="archives" title="February 2008" 
href="http://www.philosophicalgeek.com/2008/02/">
	<link rel="archives" title="January 2008" 
href="http://www.philosophicalgeek.com/2008/01/">
	<link rel="archives" title="December 2007" 
href="http://www.philosophicalgeek.com/2007/12/">
	<link rel="archives" title="November 2007" 
href="http://www.philosophicalgeek.com/2007/11/">
	<link rel="archives" title="October 2007" 
href="http://www.philosophicalgeek.com/2007/10/">
	<link rel="archives" title="September 2007" 
href="http://www.philosophicalgeek.com/2007/09/">
	<link rel="archives" title="August 2007" 
href="http://www.philosophicalgeek.com/2007/08/">
	<link rel="archives" title="July 2007" 
href="http://www.philosophicalgeek.com/2007/07/">
	<link rel="archives" title="June 2007" 
href="http://www.philosophicalgeek.com/2007/06/">
	<link rel="archives" title="May 2007" 
href="http://www.philosophicalgeek.com/2007/05/">
	<link rel="archives" title="April 2007" 
href="http://www.philosophicalgeek.com/2007/04/">
	<link rel="archives" title="March 2007" 
href="http://www.philosophicalgeek.com/2007/03/">
	<link rel="archives" title="January 2007" 
href="http://www.philosophicalgeek.com/2007/01/">
	<link rel="archives" title="December 2006" 
href="http://www.philosophicalgeek.com/2006/12/">
	<link rel="archives" title="November 2006" 
href="http://www.philosophicalgeek.com/2006/11/">
	<link rel="archives" title="September 2006" 
href="http://www.philosophicalgeek.com/2006/09/">
	<link rel="archives" title="August 2006" 
href="http://www.philosophicalgeek.com/2006/08/">
	<link rel="archives" title="July 2006" 
href="http://www.philosophicalgeek.com/2006/07/">
	<link rel="archives" title="June 2006" 
href="http://www.philosophicalgeek.com/2006/06/">
	<link rel="archives" title="May 2006" 
href="http://www.philosophicalgeek.com/2006/05/">
	<link rel="archives" title="April 2006" 
href="http://www.philosophicalgeek.com/2006/04/">
	<link rel="archives" title="March 2006" 
href="http://www.philosophicalgeek.com/2006/03/">
	<link rel="archives" title="February 2006" 
href="http://www.philosophicalgeek.com/2006/02/">
	<link rel="archives" title="January 2006" 
href="http://www.philosophicalgeek.com/2006/01/">
	<link rel="archives" title="December 2005" 
href="http://www.philosophicalgeek.com/2005/12/">
	<link rel="archives" title="November 2005" 
href="http://www.philosophicalgeek.com/2005/11/">
	<link rel="archives" title="September 2005" 
href="http://www.philosophicalgeek.com/2005/09/">
	<link rel="archives" title="August 2005" 
href="http://www.philosophicalgeek.com/2005/08/">
	<link rel="archives" title="July 2005" 
href="http://www.philosophicalgeek.com/2005/07/">
	<link rel="archives" title="June 2005" 
href="http://www.philosophicalgeek.com/2005/06/">
	<link rel="archives" title="May 2005" 
href="http://www.philosophicalgeek.com/2005/05/">
	<link rel="archives" title="April 2005" 
href="http://www.philosophicalgeek.com/2005/04/">
	<link rel="archives" title="March 2005" 
href="http://www.philosophicalgeek.com/2005/03/">
	<link rel="archives" title="February 2005" 
href="http://www.philosophicalgeek.com/2005/02/">
	<link rel="archives" title="December 2004" 
href="http://www.philosophicalgeek.com/2004/12/">
	<link rel="archives" title="October 2004" 
href="http://www.philosophicalgeek.com/2004/10/">
	<link rel="archives" title="August 2002" 
href="http://www.philosophicalgeek.com/2002/08/">
	<link rel="archives" title="May 2002" 
href="http://www.philosophicalgeek.com/2002/05/">
	<link rel="archives" title="April 2002" 
href="http://www.philosophicalgeek.com/2002/04/">
		<link rel="stylesheet" 
href="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/style.css"
 type="text/css" media="screen"><style type="text/css">div.ilsb-parent , div.ilsb-child {background-color:#FFFFFF;}div.ilsb-child {border-bottom:2px solid #884098}div.ilsb-child span {display:block;}</style><link
 rel="alternate" type="application/rss+xml" title="Philosophical Geek » 
Determine CPU usage of current process (C++ and C#) Comments Feed" 
href="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/feed/">
<script type="text/javascript" src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/jquery.js"></script>
<script type="text/javascript" src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/ilsb.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" 
href="http://www.philosophicalgeek.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" 
href="http://www.philosophicalgeek.com/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="Philosophical Geek" 
href="http://www.philosophicalgeek.com/">
<link rel="start" title="The Customer Service that Keeps on Serving" 
href="http://www.philosophicalgeek.com/2004/10/24/2/">
<link rel="prev" title="An easy stack layout panel for WinForms" 
href="http://www.philosophicalgeek.com/2008/12/12/an-easy-stack-layout-panel-for-winforms/">
<link rel="next" title="How to learn WPF (or anything else)" 
href="http://www.philosophicalgeek.com/2009/01/29/how-to-learn-wpf-or-anything-else/">
<meta name="generator" content="WordPress 2.9.2">
<link rel="canonical" 
href="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/">

<script type="text/javascript">var AKPC_IDS = "";</script>
		<meta name="keywords" content=""></head><body><div id="container">

<div id="header">

	<div id="menu">
		<ul>
			<li><a href="http://www.philosophicalgeek.com/" title="Philosophical 
Geek">Home</a></li>
			<li><a href="http://www.philosophicalgeek.com/about-me" title="About">About</a></li>
            <li><a href="http://www.philosophicalgeek.com/c-4-0-how-to" 
title="C# 4.0 How-To">C# 4.0 How-To</a></li>
			<li><a href="http://www.philosophicalgeek.com/software" 
title="Software">Software</a></li>
            <li><a href="http://www.philosophicalgeek.com/music" 
title="Music">Music</a></li>
			<li><a href="http://www.philosophicalgeek.com/cv" title="Resume">Resume</a></li>
		</ul>
	</div>

	<div id="pagetitle">
		<h1><a href="http://www.philosophicalgeek.com/" title="Philosophical 
Geek">Philosophical Geek</a></h1>

	</div>


	<div id="syndication">
	Code and musings by Ben Watson
	</div>


</div>

<div class="pagewrapper"><div class="page">

<!-- Start Obar -->

	<div class="obar">
<ul>
<li>
<div id="twitter_div">
<h2 class="twitter-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul></div>
<a href="http://twitter.com/benmwatson" id="twitter-link">follow me on 
Twitter</a>
</li>

<li id="text-350506264" class="widget widget_text">			<div 
class="textwidget"><div style="margin: 0px;">
  <embed 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/widget2.swf"
 quality="high" wmode="transparent" 
flashvars="id=929282&amp;shelf=currently-reading&amp;title=Currently 
Reading&amp;host=www.goodreads.com&amp;sort=date_added&amp;order=d&amp;params=amazon,,dest_site,goodreads"
 width="190" height="300">
  
</div>
<div style="margin: 0px;">
<a href="http://www.goodreads.com/user/show/929282-ben-watson" 
target="_blank"><img alt="Ben Watson's currently-reading book 
recommendations, reviews, favorite quotes, book clubs, book trivia, book
 lists" 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/widget_logo.gif"
 title="Ben Watson's currently-reading book recommendations, reviews, 
favorite quotes, book clubs, book trivia, book lists" border="0" 
width="190" height="32"></a>
</div>
</div>
		</li>
<li id="pages-2" class="widget widget_pages"><h2 class="widgettitle">Pages</h2>
		<ul>
			<li class="page_item page-item-18"><a 
href="http://www.philosophicalgeek.com/about-me/" title="About Me">About
 Me</a></li>
<li class="page_item page-item-567"><a 
href="http://www.philosophicalgeek.com/c-4-0-how-to/" title="C# 4.0 
How-To">C# 4.0 How-To</a></li>
<li class="page_item page-item-158"><a 
href="http://www.philosophicalgeek.com/music/" title="Music">Music</a></li>
<li class="page_item page-item-34"><a 
href="http://www.philosophicalgeek.com/cv/" title="Resume">Resume</a></li>
<li class="page_item page-item-159"><a 
href="http://www.philosophicalgeek.com/software/" title="Software">Software</a>
<ul>
	<li class="page_item page-item-512"><a 
href="http://www.philosophicalgeek.com/software/diskslicer/" 
title="DiskSlicer">DiskSlicer</a></li>
	<li class="page_item page-item-517"><a 
href="http://www.philosophicalgeek.com/software/windows-media-top-10-plugin/"
 title="Windows Media Top 10 Plugin">Windows Media Top 10 Plugin</a></li>
</ul>
</li>
		</ul>
		</li>
<li id="categories-1" class="widget widget_categories"><h2 
class="widgettitle">Categories</h2>
		<ul>
	<li class="cat-item cat-item-288"><a 
href="http://www.philosophicalgeek.com/category/a-better-future/" 
title="View all posts filed under A Better Future">A Better Future</a> 
(5)
</li>
	<li class="cat-item cat-item-11"><a 
href="http://www.philosophicalgeek.com/category/books/" title="View all 
posts filed under Books">Books</a> (15)
</li>
	<li class="cat-item cat-item-4"><a 
href="http://www.philosophicalgeek.com/category/code/" title="View all 
posts filed under Code">Code</a> (79)
<ul class="children">
	<li class="cat-item cat-item-326"><a 
href="http://www.philosophicalgeek.com/category/code/wpf-code/" 
title="View all posts filed under WPF">WPF</a> (2)
</li>
</ul>
</li>
	<li class="cat-item cat-item-2"><a 
href="http://www.philosophicalgeek.com/category/humor/" title="Funny 
things that have happened to me, stories I've heard....anything">Humor</a>
 (26)
</li>
	<li class="cat-item cat-item-17"><a 
href="http://www.philosophicalgeek.com/category/interviewing/" 
title="View all posts filed under Interviewing">Interviewing</a> (7)
</li>
	<li class="cat-item cat-item-66"><a 
href="http://www.philosophicalgeek.com/category/lego/" title="View all 
posts filed under lego">lego</a> (5)
</li>
	<li class="cat-item cat-item-14"><a 
href="http://www.philosophicalgeek.com/category/links/" title="View all 
posts filed under Link/News">Link/News</a> (83)
</li>
	<li class="cat-item cat-item-33"><a 
href="http://www.philosophicalgeek.com/category/microsoft/" title="View 
all posts filed under microsoft">microsoft</a> (11)
<ul class="children">
	<li class="cat-item cat-item-321"><a 
href="http://www.philosophicalgeek.com/category/microsoft/bing/" 
title="View all posts filed under Bing">Bing</a> (1)
</li>
	<li class="cat-item cat-item-315"><a 
href="http://www.philosophicalgeek.com/category/microsoft/live-search-microsoft/"
 title="View all posts filed under Live Search">Live Search</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-10"><a 
href="http://www.philosophicalgeek.com/category/music-film-theater/" 
title="View all posts filed under Music, Film, Theater">Music, Film, 
Theater</a> (21)
</li>
	<li class="cat-item cat-item-26"><a 
href="http://www.philosophicalgeek.com/category/personal/" title="View 
all posts filed under Personal">Personal</a> (35)
</li>
	<li class="cat-item cat-item-322"><a 
href="http://www.philosophicalgeek.com/category/photos/" title="View all
 posts filed under Photos">Photos</a> (4)
</li>
	<li class="cat-item cat-item-24"><a 
href="http://www.philosophicalgeek.com/category/software-development/" 
title="View all posts filed under Software Development">Software 
Development</a> (54)
</li>
	<li class="cat-item cat-item-25"><a 
href="http://www.philosophicalgeek.com/category/thoughts-on-technology/"
 title="View all posts filed under Thoughts On Tech and More">Thoughts 
On Tech and More</a> (43)
</li>
	<li class="cat-item cat-item-23"><a 
href="http://www.philosophicalgeek.com/category/tips/" title="View all 
posts filed under Tips">Tips</a> (31)
</li>
	<li class="cat-item cat-item-1"><a 
href="http://www.philosophicalgeek.com/category/uncategorized/" 
title="View all posts filed under Uncategorized">Uncategorized</a> (1)
</li>
		</ul>
</li>
<li id="text-350506261" class="widget widget_text">			<div 
class="textwidget"><a 
href="http://www.maximumfun.org/blog/2009/01/beginners-guide-to-maximumfunorg.html"><img
 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/tsoyatallbanner.jpg"
 width="90%" height="90%"></a></div>
		</li>
<li id="linkcat-13" class="widget widget_links"><h2 class="widgettitle">Blogs
 I Read</h2>

	<ul class="xoxo blogroll">
<li><a href="http://www.codinghorror.com/blog/" title="programming and 
human factors by Jeff Atwood">Coding Horror</a></li>
<li><a href="http://dilbertblog.typepad.com/" title="Scott Adams’ 
hilarious blog">Dilbert Blog</a></li>
<li><a href="http://blogs.msdn.com/larryosterman/" title="Confessions of
 an old fogey">Larry Osterman</a></li>
<li><a href="http://blogs.msdn.com/oldnewthing/" title="The Old New 
Thing">Raymond Chen</a></li>
<li><a href="http://www.schneier.com/blog/" title="Great discussions on 
security, computer and otherwise">Schneier on Security</a></li>
<li><a href="http://www.techdirt.com/" title="Interesting commentary on 
tech news of the day">TechDirt</a></li>

	</ul>
</li>

<li id="linkcat-278" class="widget widget_links"><h2 class="widgettitle">Fun/Random</h2>

	<ul class="xoxo blogroll">
<li><a href="http://www.basicinstructions.net/" title="A hilarious web 
comic">Basic Instructions</a></li>
<li><a href="http://www.dailywtf.com/" title="Programmers doing Bad 
Things">Daily WTF</a></li>
<li><a href="http://lmotd.blogspot.com/" title="Great pictures of a LEGO
 model from the web">LEGO Model of the Day</a></li>
<li><a href="http://www.brothers-brick.com/" title="LEGO goodness">The 
Brothers Brick</a></li>
<li><a href="http://www.thrumyeyes.us/" title="A great Utah photographer
 I know.">Thru My Eyes – Photos</a></li>
<li><a href="http://xkcd.com/" title="Great web comic">xkcd</a></li>

	</ul>
</li>


</ul>

	</div>

<!-- End Obar -->
	<div class="wrapper"><!-- This wrapper class appears only on Page and Single Post pages. -->
	<div class="narrowcolumnwrapper"><div class="narrowcolumn">

		<div class="content">

			
			<div class="post" id="post-434">

				<h2><a 
href="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/"
 rel="bookmark" title="Determine CPU usage of current process (C++ and 
C#)">Determine CPU usage of current process (C++ and C#)</a></h2>

				<div class="postinfo">
Posted on <span class="postdate">January 3rd, 2009</span> by Ben 				</div>

				<div class="entry">

					<span style="float: left; margin-top: 7px;">
										</span>
					<p><strong></strong><strong>My first book, <a 
href="http://www.amazon.com/gp/product/0672330636?ie=UTF8&amp;tag=philosophic0d-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0672330636">C#
 4.0 How-To</a> is now shipping! If you like tips you can use, check it 
out!</strong></p>
<p><em><strong>Updated 2/4/2009: </strong>I changed the implementation 
of these classes from the original:</em></p>
<ul>
<li><em>Instead of a critical section, InterlockedIncrement/Decrement is
 used.</em></li>
<li><em>The sample driver program now demos using multiple threads using
 the CpuUsage class to show thread safety.</em></li>
</ul>
<p><a href="http://www.philosophicalgeek.com/downloads/CpuUsage.zip">Download</a>
 the C++ and C# projects that accompany this article.</p>
<p>Just to make it clear, there is no API called 
GetProcessCpuPercentage(). To find out the percentage, we can use some 
other, real APIs and do some calculations. Before getting to the 
equation and code, let’s discuss the different types of time available.</p>
<p>There are four types of time:</p>
<ol>
<li>Wall time – The actual, real-world progression of time as measured 
by you on your watch.</li>
<li>Kernel time – The amount of time spent in kernel mode (protected, 
high-order mode of operation)</li>
<li>User time – the amount of time spent in user-mode (often by the 
process itself)</li>
<li>Idle time – nothing going on at all</li>
</ol>
<p>Kernel, User, and Idle sum to total time, which is approximately 
wall-time.</p>
<p>Each process spends some time in kernel mode and some time in user 
mode. We just need to compare the time spent by a process to the time 
spent by all processes on the computer, since the last time we made such
 a measurement. It is important to note that we do NOT take into account
 the idle time.</p>
<p>Thus, the equation is</p>
<p><a 
href="http://www.philosophicalgeek.com/wp-content/uploads/2009/01/cpupercentageequation.png"><img
 style="display: block; float: none; margin-left: auto; margin-right: 
auto; border-width: 0px;" title="CpuPercentageEquation" 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/cpupercentageequation-thumb.png"
 alt="CpuPercentageEquation" border="0" width="240" height="32"></a></p>
<p>There are two APIs that are useful:</p>
<ul>
<li><a 
href="http://msdn.microsoft.com/en-us/library/ms683223%28VS.85%29.aspx">GetProcessTimes</a>
 – Get times for a specific process</li>
<li><a 
href="http://msdn.microsoft.com/en-us/library/ms724400%28VS.85%29.aspx">GetSystemTimes</a>
 – Get total times for the entire system (all CPUs)</li>
</ul>
<p>The times reported are absolute, so what we are actually interested 
is in the difference between the current times and those from a previous
 run.</p>
<p>Armed with this information, we can calculate the CPU usage for the 
current process (or any arbitrary process, for that matter).</p>
<p>Let’s do it first in C++ to demonstrate usage of the APIs.</p>
<h3>CPU Usage Percentage in C++</h3>
<p>Here’s the header file:</p>
<div>
<div style="line-height: 12pt; background-color: rgb(244, 244, 244); 
width: 100%; font-family: consolas,'Courier New',courier,monospace; 
color: black; font-size: 8pt; overflow: visible; border-style: none; 
padding: 0px;">
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   1:</span> <span style="color: rgb(204, 102, 51);">#pragma</span> once</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   2:</span> #include &lt;windows.h&gt;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   3:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   4:</span> <span style="color: rgb(0, 0, 255);">class</span> CpuUsage</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   5:</span> {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   6:</span> <span style="color: rgb(0, 0, 255);">public</span>:</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   7:</span>     CpuUsage(<span style="color: rgb(0, 0, 255);">void</span>);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   8:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   9:</span>     <span style="color: rgb(0, 0, 255);">short</span>  GetUsage();</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  10:</span> <span style="color: rgb(0, 0, 255);">private</span>:</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  11:</span>     ULONGLONG SubtractTimes(<span style="color: rgb(0, 0, 255);">const</span> FILETIME&amp; ftA, <span style="color: rgb(0, 0, 255);">const</span> FILETIME&amp; ftB);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  12:</span>     <span style="color: rgb(0, 0, 255);">bool</span> EnoughTimePassed();</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  13:</span>     inline <span style="color: rgb(0, 0, 255);">bool</span> IsFirstRun() <span style="color: rgb(0, 0, 255);">const</span> { <span style="color: rgb(0, 0, 255);">return</span> (m_dwLastRun == 0); }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  14:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  15:</span>     <span style="color: rgb(0, 128, 0);">//system total times</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  16:</span>     FILETIME m_ftPrevSysKernel;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  17:</span>     FILETIME m_ftPrevSysUser;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  18:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  19:</span>     <span style="color: rgb(0, 128, 0);">//process times</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  20:</span>     FILETIME m_ftPrevProcKernel;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  21:</span>     FILETIME m_ftPrevProcUser;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  22:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  23:</span>     <span style="color: rgb(0, 0, 255);">short</span> m_nCpuUsage;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  24:</span>     ULONGLONG m_dwLastRun;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  25:</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  26:</span>     <span style="color: rgb(0, 0, 255);">volatile</span> LONG m_lRunCount;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  27:</span> };</pre>
</div>
</div>
<p>The GetUsage() method is where the work occurs. The other methods are
 to help in the calculations. The <span style="text-decoration: 
line-through;">critical section</span> run count enables the code to be 
called in a multi-threaded environment without problems. I also prevent 
the code from being called more often than every 250ms. Here is the 
complete implementation:</p>
<div>
<div style="line-height: 12pt; background-color: rgb(244, 244, 244); 
width: 100%; font-family: consolas,'Courier New',courier,monospace; 
color: black; font-size: 8pt; overflow: visible; border-style: none; 
padding: 0px;">
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   1:</span> #include <span style="color: rgb(0, 96, 128);">"StdAfx.h"</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   2:</span> #include &lt;windows.h&gt;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   3:</span> #include <span style="color: rgb(0, 96, 128);">"CpuUsage.h"</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   4:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   5:</span> CpuUsage::CpuUsage(<span style="color: rgb(0, 0, 255);">void</span>)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   6:</span> :m_nCpuUsage(-1)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   7:</span> ,m_dwLastRun(0)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   8:</span> ,m_lRunCount(0)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   9:</span> {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  10:</span>     ZeroMemory(&amp;m_ftPrevSysKernel, <span style="color: rgb(0, 0, 255);">sizeof</span>(FILETIME));</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  11:</span>     ZeroMemory(&amp;m_ftPrevSysUser, <span style="color: rgb(0, 0, 255);">sizeof</span>(FILETIME));</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  12:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  13:</span>     ZeroMemory(&amp;m_ftPrevProcKernel, <span style="color: rgb(0, 0, 255);">sizeof</span>(FILETIME));</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  14:</span>     ZeroMemory(&amp;m_ftPrevProcUser, <span style="color: rgb(0, 0, 255);">sizeof</span>(FILETIME));</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  15:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  16:</span> }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  17:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  18:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  19:</span> <span style="color: rgb(0, 128, 0);">/**********************************************</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  20:</span> <span style="color: rgb(0, 128, 0);">* CpuUsage::GetUsage</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  21:</span> <span style="color: rgb(0, 128, 0);">* returns the percent of the CPU that this process</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  22:</span> <span style="color: rgb(0, 128, 0);">* has used since the last time the method was called.</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  23:</span> <span style="color: rgb(0, 128, 0);">* If there is not enough information, -1 is returned.</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  24:</span> <span style="color: rgb(0, 128, 0);">* If the method is recalled to quickly, the previous value</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  25:</span> <span style="color: rgb(0, 128, 0);">* is returned.</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  26:</span> <span style="color: rgb(0, 128, 0);">***********************************************/</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  27:</span> <span style="color: rgb(0, 0, 255);">short</span> CpuUsage::GetUsage()</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  28:</span> {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  29:</span>     <span style="color: rgb(0, 128, 0);">//create a local copy to protect against race conditions in setting the </span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  30:</span>     <span style="color: rgb(0, 128, 0);">//member variable</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  31:</span>     <span style="color: rgb(0, 0, 255);">short</span> nCpuCopy = m_nCpuUsage;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  32:</span>     <span style="color: rgb(0, 0, 255);">if</span> (::InterlockedIncrement(&amp;m_lRunCount) == 1)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  33:</span>     {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  34:</span>         <span style="color: rgb(0, 128, 0);">/*</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  35:</span> <span style="color: rgb(0, 128, 0);">        If this is called too often, the measurement itself will greatly </span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  36:</span> <span style="color: rgb(0, 128, 0);">        affect the results.</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  37:</span> <span style="color: rgb(0, 128, 0);">        */</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  38:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  39:</span>         <span style="color: rgb(0, 0, 255);">if</span> (!EnoughTimePassed())</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  40:</span>         {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  41:</span>             ::InterlockedDecrement(&amp;m_lRunCount);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  42:</span>             <span style="color: rgb(0, 0, 255);">return</span> nCpuCopy;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  43:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  44:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  45:</span>         FILETIME ftSysIdle, ftSysKernel, ftSysUser;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  46:</span>         FILETIME ftProcCreation, ftProcExit, ftProcKernel, ftProcUser;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  47:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  48:</span>         <span style="color: rgb(0, 0, 255);">if</span> (!GetSystemTimes(&amp;ftSysIdle, &amp;ftSysKernel, &amp;ftSysUser) ||</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  49:</span>             !GetProcessTimes(GetCurrentProcess(), &amp;ftProcCreation,</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  50:</span>                 &amp;ftProcExit, &amp;ftProcKernel, &amp;ftProcUser))</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  51:</span>         {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  52:</span>             ::InterlockedDecrement(&amp;m_lRunCount);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  53:</span>             <span style="color: rgb(0, 0, 255);">return</span> nCpuCopy;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  54:</span>         }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  55:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  56:</span>         <span style="color: rgb(0, 0, 255);">if</span> (!IsFirstRun())</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  57:</span>         {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  58:</span>             <span style="color: rgb(0, 128, 0);">/*</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  59:</span> <span style="color: rgb(0, 128, 0);">            CPU usage is calculated by getting the total amount of time </span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  60:</span> <span style="color: rgb(0, 128, 0);">            the system has operated since the last measurement </span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  61:</span> <span style="color: rgb(0, 128, 0);">            (made up of kernel + user) and the total</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  62:</span> <span style="color: rgb(0, 128, 0);">            amount of time the process has run (kernel + user).</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  63:</span> <span style="color: rgb(0, 128, 0);">            */</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  64:</span>             ULONGLONG ftSysKernelDiff =</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  65:</span>                 SubtractTimes(ftSysKernel, m_ftPrevSysKernel);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  66:</span>             ULONGLONG ftSysUserDiff =</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  67:</span>                 SubtractTimes(ftSysUser, m_ftPrevSysUser);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  68:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  69:</span>             ULONGLONG ftProcKernelDiff =</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  70:</span>                 SubtractTimes(ftProcKernel, m_ftPrevProcKernel);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  71:</span>             ULONGLONG ftProcUserDiff =</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  72:</span>             SubtractTimes(ftProcUser, m_ftPrevProcUser);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  73:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  74:</span>             ULONGLONG nTotalSys =  ftSysKernelDiff + ftSysUserDiff;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  75:</span>             ULONGLONG nTotalProc = ftProcKernelDiff + ftProcUserDiff;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  76:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  77:</span>             <span style="color: rgb(0, 0, 255);">if</span> (nTotalSys &gt; 0)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  78:</span>             {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  79:</span>                 m_nCpuUsage = (<span style="color: rgb(0, 0, 255);">short</span>)((100.0 * nTotalProc) / nTotalSys);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  80:</span>             }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  81:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  82:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  83:</span>         m_ftPrevSysKernel = ftSysKernel;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  84:</span>         m_ftPrevSysUser = ftSysUser;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  85:</span>         m_ftPrevProcKernel = ftProcKernel;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  86:</span>         m_ftPrevProcUser = ftProcUser;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  87:</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  88:</span>         m_dwLastRun = GetTickCount64();</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  89:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  90:</span>         nCpuCopy = m_nCpuUsage;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  91:</span>     }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  92:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  93:</span>     ::InterlockedDecrement(&amp;m_lRunCount);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  94:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  95:</span>     <span style="color: rgb(0, 0, 255);">return</span> nCpuCopy;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  96:</span> }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  97:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  98:</span> ULONGLONG CpuUsage::SubtractTimes(<span style="color: rgb(0, 0, 255);">const</span> FILETIME&amp; ftA, <span style="color: rgb(0, 0, 255);">const</span> FILETIME&amp; ftB)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  99:</span> {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 100:</span>     LARGE_INTEGER a, b;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 101:</span>     a.LowPart = ftA.dwLowDateTime;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 102:</span>     a.HighPart = ftA.dwHighDateTime;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 103:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 104:</span>     b.LowPart = ftB.dwLowDateTime;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 105:</span>     b.HighPart = ftB.dwHighDateTime;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 106:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 107:</span>     <span style="color: rgb(0, 0, 255);">return</span> a.QuadPart - b.QuadPart;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 108:</span> }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 109:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 110:</span> <span style="color: rgb(0, 0, 255);">bool</span> CpuUsage::EnoughTimePassed()</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 111:</span> {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 112:</span>     <span style="color: rgb(0, 0, 255);">const</span> <span style="color: rgb(0, 0, 255);">int</span> minElapsedMS = 250;<span style="color: rgb(0, 128, 0);">//milliseconds</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 113:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 114:</span>     ULONGLONG dwCurrentTickCount = GetTickCount64();</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 115:</span>     <span style="color: rgb(0, 0, 255);">return</span> (dwCurrentTickCount - m_dwLastRun) &gt; minElapsedMS;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 116:</span> }</pre>
</div>
</div>
<p>In order to test this, here is a simple program that starts two 
threads that run an infinite loop, eating the processor. On a dual-core 
system, this process will take roughly 85-95% of the CPU. I also start 
two threads to access the usage object and poll the CPU usage in order 
to demonstrate the thread safety of the object.</p>
<div>
<div style="line-height: 12pt; background-color: rgb(244, 244, 244); 
width: 100%; font-family: consolas,'Courier New',courier,monospace; 
color: black; font-size: 8pt; overflow: visible; border-style: none; 
padding: 0px;">
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   1:</span> <span style="color: rgb(0, 128, 0);">// CpuUsageCpp.cpp : Defines the entry point for the console application.</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   2:</span> <span style="color: rgb(0, 128, 0);">//</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   3:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   4:</span> #include <span style="color: rgb(0, 96, 128);">"stdafx.h"</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   5:</span> #include &lt;windows.h&gt;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   6:</span> #include <span style="color: rgb(0, 96, 128);">"CpuUsage.h"</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   7:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   8:</span> DWORD WINAPI EatItThreadProc(LPVOID lpParam);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   9:</span> DWORD WINAPI WatchItThreadProc(LPVOID lpParam);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  10:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  11:</span> CpuUsage usage;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  12:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  13:</span> <span style="color: rgb(0, 0, 255);">int</span> _tmain(<span style="color: rgb(0, 0, 255);">int</span> argc, _TCHAR* argv[])</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  14:</span> {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  15:</span>     <span style="color: rgb(0, 128, 0);">//start threads to eat the processor</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  16:</span>     CreateThread(NULL, 0, EatItThreadProc, NULL, 0, NULL);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  17:</span>     CreateThread(NULL, 0, EatItThreadProc, NULL, 0, NULL);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  18:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  19:</span>     <span style="color: rgb(0, 128, 0);">//start threads to watch the processor (to test thread-safety)</span></pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  20:</span>     CreateThread(NULL, 0, WatchItThreadProc, NULL, 0, NULL);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  21:</span>     CreateThread(NULL, 0, WatchItThreadProc, NULL, 0, NULL);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  22:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  23:</span>     <span style="color: rgb(0, 0, 255);">while</span> (<span style="color: rgb(0, 0, 255);">true</span>)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  24:</span>     {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  25:</span>         Sleep(1000);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  26:</span>     }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  27:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  28:</span>     <span style="color: rgb(0, 0, 255);">return</span> 0;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  29:</span> }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  30:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  31:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  32:</span> DWORD WINAPI WatchItThreadProc(LPVOID lpParam)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  33:</span> {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  34:</span>     <span style="color: rgb(0, 0, 255);">while</span> (<span style="color: rgb(0, 0, 255);">true</span>)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  35:</span>     {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  36:</span>         <span style="color: rgb(0, 0, 255);">short</span> cpuUsage = usage.GetUsage();</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  37:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  38:</span>         printf(<span style="color: rgb(0, 96, 128);">"Thread id %d: %d%% cpu usage\n"</span>, ::GetCurrentThreadId(), cpuUsage);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  39:</span>         Sleep(1000);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  40:</span>     }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  41:</span> }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  42:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  43:</span> DWORD WINAPI EatItThreadProc(LPVOID lpParam)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  44:</span> {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  45:</span>     ULONGLONG accum = 0;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  46:</span>     <span style="color: rgb(0, 0, 255);">while</span> (<span style="color: rgb(0, 0, 255);">true</span>)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  47:</span>     {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  48:</span>         accum++;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  49:</span>     }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  50:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  51:</span>     printf(<span style="color: rgb(0, 96, 128);">"%64d\n"</span>, accum);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  52:</span> }</pre>
</div>
</div>
<h3>C# Version</h3>
<p>In C#, The <a 
href="http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx">System.Diagnostics.Process</a>
 can give us the time information for a specific process. However, we 
still need the Win32 API call for getting the total system times 
(GetSystemTimes). The Process class reports times in <a 
href="http://msdn.microsoft.com/en-us/library/system.timespan.aspx">TimeSpans</a>,
 not <a 
href="http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.comtypes.filetime.aspx">FILETIME</a>,
 so our class is modified accordingly.</p>
<div>
<div style="line-height: 12pt; background-color: rgb(244, 244, 244); 
width: 100%; font-family: consolas,'Courier New',courier,monospace; 
color: black; font-size: 8pt; overflow: visible; border-style: none; 
padding: 0px;">
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   1:</span> <span style="color: rgb(0, 0, 255);">using</span> System;<span style="color: rgb(0, 0, 255);">using</span> System.Collections.Generic;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   2:</span> <span style="color: rgb(0, 0, 255);">using</span> System.Linq;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   3:</span> <span style="color: rgb(0, 0, 255);">using</span> System.Text;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   4:</span> <span style="color: rgb(0, 0, 255);">using</span> System.Runtime.InteropServices;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   5:</span> <span style="color: rgb(0, 0, 255);">using</span> ComTypes = System.Runtime.InteropServices.ComTypes;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   6:</span> <span style="color: rgb(0, 0, 255);">using</span> System.Threading;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   7:</span> <span style="color: rgb(0, 0, 255);">using</span> System.Diagnostics;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   8:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">   9:</span> <span style="color: rgb(0, 0, 255);">namespace</span> CpuUsageCs</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  10:</span> {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  11:</span>     <span style="color: rgb(0, 0, 255);">class</span> CpuUsage</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  12:</span>     {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  13:</span>         [DllImport(<span style="color: rgb(0, 96, 128);">"kernel32.dll"</span>, SetLastError = <span style="color: rgb(0, 0, 255);">true</span>)]</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  14:</span>         <span style="color: rgb(0, 0, 255);">static</span> <span style="color: rgb(0, 0, 255);">extern</span> <span style="color: rgb(0, 0, 255);">bool</span> GetSystemTimes(</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  15:</span>                     <span style="color: rgb(0, 0, 255);">out</span> ComTypes.FILETIME lpIdleTime,</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  16:</span>                     <span style="color: rgb(0, 0, 255);">out</span> ComTypes.FILETIME lpKernelTime,</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  17:</span>                     <span style="color: rgb(0, 0, 255);">out</span> ComTypes.FILETIME lpUserTime</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  18:</span>                     );</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  19:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  20:</span>         ComTypes.FILETIME _prevSysKernel;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  21:</span>         ComTypes.FILETIME _prevSysUser;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  22:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  23:</span>         TimeSpan _prevProcTotal;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  24:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  25:</span>         Int16 _cpuUsage;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  26:</span>         DateTime _lastRun;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  27:</span>         <span style="color: rgb(0, 0, 255);">long</span> _runCount;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  28:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  29:</span>         <span style="color: rgb(0, 0, 255);">public</span> CpuUsage()</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  30:</span>         {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  31:</span>             _cpuUsage = -1;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  32:</span>             _lastRun = DateTime.MinValue;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  33:</span>             _prevSysUser.dwHighDateTime = _prevSysUser.dwLowDateTime = 0;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  34:</span>             _prevSysKernel.dwHighDateTime = _prevSysKernel.dwLowDateTime = 0;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  35:</span>             _prevProcTotal = TimeSpan.MinValue;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  36:</span>             _runCount = 0;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  37:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  38:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  39:</span>         <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">short</span> GetUsage()</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  40:</span>         {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  41:</span>             <span style="color: rgb(0, 0, 255);">short</span> cpuCopy = _cpuUsage;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  42:</span>             <span style="color: rgb(0, 0, 255);">if</span> (Interlocked.Increment(<span style="color: rgb(0, 0, 255);">ref</span> _runCount) == 1)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  43:</span>             {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  44:</span>                 <span style="color: rgb(0, 0, 255);">if</span> (!EnoughTimePassed)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  45:</span>                 {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  46:</span>                     Interlocked.Decrement(<span style="color: rgb(0, 0, 255);">ref</span> _runCount);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  47:</span>                     <span style="color: rgb(0, 0, 255);">return</span> cpuCopy;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  48:</span>                 }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  49:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  50:</span>                 ComTypes.FILETIME sysIdle, sysKernel, sysUser;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  51:</span>                 TimeSpan procTime;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  52:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  53:</span>                 Process process = Process.GetCurrentProcess();</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  54:</span>                 procTime = process.TotalProcessorTime;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  55:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  56:</span>                 <span style="color: rgb(0, 0, 255);">if</span> (!GetSystemTimes(<span style="color: rgb(0, 0, 255);">out</span> sysIdle, <span style="color: rgb(0, 0, 255);">out</span> sysKernel, <span style="color: rgb(0, 0, 255);">out</span> sysUser))</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  57:</span>                 {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  58:</span>                     Interlocked.Decrement(<span style="color: rgb(0, 0, 255);">ref</span> _runCount);</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  59:</span>                     <span style="color: rgb(0, 0, 255);">return</span> cpuCopy;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  60:</span>                 }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  61:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  62:</span>                 <span style="color: rgb(0, 0, 255);">if</span> (!IsFirstRun)</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  63:</span>                 {</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  64:</span>                     UInt64 sysKernelDiff =</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  65:</span>                         SubtractTimes(sysKernel, _prevSysKernel);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  66:</span>                     UInt64 sysUserDiff =</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  67:</span>                         SubtractTimes(sysUser, _prevSysUser);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  68:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  69:</span>                     UInt64 sysTotal = sysKernelDiff + sysUserDiff;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  70:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  71:</span>                     Int64 procTotal = procTime.Ticks - _prevProcTotal.Ticks;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  72:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  73:</span>                     <span style="color: rgb(0, 0, 255);">if</span> (sysTotal &gt; 0)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  74:</span>                     {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  75:</span>                         _cpuUsage = (<span style="color: rgb(0, 0, 255);">short</span>)((100.0 * procTotal) / sysTotal);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  76:</span>                     }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  77:</span>                 }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  78:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  79:</span>                 _prevProcTotal = procTime;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  80:</span>                 _prevSysKernel = sysKernel;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  81:</span>                 _prevSysUser = sysUser;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  82:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  83:</span>                 _lastRun = DateTime.Now;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  84:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  85:</span>                 cpuCopy = _cpuUsage;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  86:</span>             }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  87:</span>             Interlocked.Decrement(<span style="color: rgb(0, 0, 255);">ref</span> _runCount);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  88:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  89:</span>             <span style="color: rgb(0, 0, 255);">return</span> cpuCopy;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  90:</span></pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  91:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  92:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  93:</span>         <span style="color: rgb(0, 0, 255);">private</span> UInt64 SubtractTimes(ComTypes.FILETIME a, ComTypes.FILETIME b)</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  94:</span>         {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  95:</span>             UInt64 aInt =</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  96:</span>             ((UInt64)(a.dwHighDateTime &lt;&lt; 32)) | (UInt64)a.dwLowDateTime;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  97:</span>             UInt64 bInt =</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  98:</span>             ((UInt64)(b.dwHighDateTime &lt;&lt; 32)) | (UInt64)b.dwLowDateTime;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);">  99:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 100:</span>             <span style="color: rgb(0, 0, 255);">return</span> aInt - bInt;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 101:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 102:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 103:</span>         <span style="color: rgb(0, 0, 255);">private</span> <span style="color: rgb(0, 0, 255);">bool</span> EnoughTimePassed</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 104:</span>         {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 105:</span>             get</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 106:</span>             {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 107:</span>                 <span style="color: rgb(0, 0, 255);">const</span> <span style="color: rgb(0, 0, 255);">int</span> minimumElapsedMS = 250;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 108:</span>                 TimeSpan sinceLast = DateTime.Now - _lastRun;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 109:</span>                 <span style="color: rgb(0, 0, 255);">return</span> sinceLast.TotalMilliseconds &gt; minimumElapsedMS;</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 110:</span>             }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 111:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 112:</span>&nbsp;</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 113:</span>         <span style="color: rgb(0, 0, 255);">private</span> <span style="color: rgb(0, 0, 255);">bool</span> IsFirstRun</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 114:</span>         {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 115:</span>             get</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 116:</span>             {</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 117:</span>                 <span style="color: rgb(0, 0, 255);">return</span> (_lastRun == DateTime.MinValue);</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 118:</span>             }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 119:</span>         }</pre>
<pre style="line-height: 12pt; background-color: rgb(244, 244, 244); margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 120:</span>     }</pre>
<pre style="line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; color: black; font-size: 8pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: rgb(96, 96, 96);"> 121:</span> }</pre>
</div>
</div>
<p>These classes can now be used wherever you need to monitor the CPU 
usage of a process.</p>
<p>Notice any improvements to be made? Leave a comment.</p>
<p><a href="http://www.philosophicalgeek.com/downloads/CpuUsage.zip">Download</a>
 C++ and C# projects</p>
<p><strong>My first book, <a 
href="http://www.amazon.com/gp/product/0672330636?ie=UTF8&amp;tag=philosophic0d-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0672330636">C#
 4.0 How-To</a> is now shipping! If you like tips you can use, check it 
out!</strong></p>
<div class="ilsb-parent ilsb-arial"><a href="#" class="ilsb ilsb-share">Share
 This!</a><br><div class="ilsb-child"><span><a rel="nofollow" 
href="http://digg.com/submit?phase=2&amp;url=http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/&amp;title=Determine+CPU+usage+of+current+process+%28C%2B%2B+and+C%23%29"
 class="ilsb ilsb-digg" title="Add to Digg">Digg</a></span><span><a 
rel="nofollow" 
href="http://del.icio.us/post?url=http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/&amp;title=Determine+CPU+usage+of+current+process+%28C%2B%2B+and+C%23%29"
 class="ilsb ilsb-delicious" title="Add to del.icio.us">del.icio.us</a></span><span><a
 rel="nofollow" 
href="http://www.facebook.com/share.php?u=http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/"
 class="ilsb ilsb-facebook" title="Share on Facebook">Facebook</a></span><span><a
 rel="nofollow" 
href="http://reddit.com/submit?url=http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/&amp;title=Determine+CPU+usage+of+current+process+%28C%2B%2B+and+C%23%29"
 class="ilsb ilsb-reddit" title="Add to Reddit">Reddit</a></span><span><a
 rel="nofollow" 
href="http://www.stumbleupon.com/submit?url=http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/&amp;title=Determine+CPU+usage+of+current+process+%28C%2B%2B+and+C%23%29"
 class="ilsb ilsb-stumbleupon" title="Add to StumbleUpon">StumbleUpon</a></span></div></div><script type="text/javascript">AKPC_IDS += "434,";</script><p
 class="akpc_pop">Popularity: 29% <span class="akpc_help">[<a 
href="http://alexking.org/projects/wordpress/popularity-contest" 
title="What does this mean?">?</a>]</span></p>					<br>


										
					<p class="postinfo">
Filed under: <a href="http://www.philosophicalgeek.com/category/code/" 
title="View all posts in Code" rel="category tag">Code</a>					</p>

					<!--
					<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
				xmlns:dc="http://purl.org/dc/elements/1.1/"
				xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
			<rdf:Description rdf:about="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/"
    dc:identifier="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/"
    dc:title="Determine CPU usage of current process (C++ and C#)"
    trackback:ping="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/trackback/" />
</rdf:RDF>					 -->
				</div>
			</div>



			<div class="browse">« <a 
href="http://www.philosophicalgeek.com/2008/12/12/an-easy-stack-layout-panel-for-winforms/"
 rel="prev">An easy stack layout panel for WinForms</a>  <a 
href="http://www.philosophicalgeek.com/2009/01/29/how-to-learn-wpf-or-anything-else/"
 rel="next">How to learn WPF (or anything else)</a> »</div>



		</div><!-- End content -->

	</div></div><!-- End narrowcolumnwrapper and narrowcolumn classes -->


<!-- Start Comments Template -->

	<div class="narrowcolumnwrapper"><div class="narrowcolumn">

		<div class="content">

			<div class="post">


<!-- You can start editing here. -->

	<h3 id="comments">26 Responses to “Determine CPU usage of current 
process (C++ and C#)”</h3>

<ol class="commentlist">

	<li class="alt" id="comment-86126">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/in.png"
 alt="INDIA" title="INDIA" class="fs_flagicon" width="16" height="11"></strong>,
 on <a href="#comment-86126" title="">February 3rd, 2009 at 3:12 pm</a> 
Said: 		</div>

<p>Hi Ben,</p>
<p>This is a great example and is quite what I have been looking for, 
but not exactly. I need to modify this to get me the CPU % used by a 
particular process…for example, I need to monitor the CPU Usage for 
“iexplore”.</p>
<p>I got stuck while trying to initialize the procTime variable</p>
<p>  Console.Write(“Enter process name: “);<br>
            String procName = Console.ReadLine();<br>
            foreach (Process process in 
Process.GetProcessesByName(procName))<br>
           procTime = process.TotalProcessorTime;</p>
<p>I get an error while compiling at the procTime initialization. I am 
not really good at C#, just a beginner..so could you help me out with 
this one please?</p>
<p>–Deekshit</p>
	</li>



	<li class="" id="comment-86387">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-86387" title="">February
 5th, 2009 at 7:51 am</a> Said: 		</div>

<p>Hi, I found the solution to caputre the usage of the process that I 
want to monitor, but the CpuUsageCs.exe program seems to be taking up 
100% of the CPU on Dual Core machines…is there any reason why it is so 
intensive? or is there a leak?</p>
<p>–Deekshit</p>
	</li>



	<li class="authcomment" id="comment-86442">

<div class="commentmetadata">
<strong><a href="http://www.philosophicalgeek.com/" rel="external 
nofollow" class="url">Ben</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-86442" title="">February
 5th, 2009 at 12:21 pm</a> Said: 		</div>

<p>Deekshit, the demo program deliberately uses a lot of the processor 
in order to demo the functionality of the CpuUsage class</p>
	</li>



	<li class="alt" id="comment-87299">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/in.png"
 alt="INDIA" title="INDIA" class="fs_flagicon" width="16" height="11"></strong>,
 on <a href="#comment-87299" title="">February 14th, 2009 at 12:33 pm</a>
 Said: 		</div>

<p>any tips on how I can optimize this program to reduce the CPU Usage?</p>
<p>I used the following method to set the thread affinity to Low</p>
<p> public static void setCurrentProgAffinity(String proc)<br>
        {<br>
            foreach (Process myCurrentProcess in 
Process.GetProcessesByName(proc))<br>
            {<br>
                myCurrentProcess.PriorityClass = 
System.Diagnostics.ProcessPriorityClass.Idle;</p>
<p>            }<br>
        }</p>
	</li>



	<li class="" id="comment-88209">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-88209" title="">February
 25th, 2009 at 11:28 am</a> Said: 		</div>

<p>Hi Ben,</p>
<p>Just need one small bit of help if you can. I am trying to get the 
CPU usage of more than one process at the same time. I am passing an 
array to the GetUsage method as follows:</p>
<p> public short GetUsage(String[] procName)<br>
        {<br>
            String[] myProcs = procName;<br>
            if (!Monitor.TryEnter(_syncLock))<br>
            {<br>
                return _cpuUsage;<br>
            }</p>
<p>            if (!EnoughTimePassed)<br>
            {<br>
                Monitor.Exit(_syncLock);<br>
                return _cpuUsage;<br>
            }</p>
<p>            ComTypes.FILETIME sysIdle, sysKernel, sysUser;<br>
            TimeSpan procTime;</p>
<p>            //Process process = Process.GetCurrentProcess();<br>
            for(int i=0;i 0)<br>
                        {<br>
                            _cpuUsage = (short)((100.0 * procTotal) / 
sysTotal);<br>
                        }<br>
                    }</p>
<p>                    _prevProcTotal = procTime;<br>
                    _prevSysKernel = sysKernel;<br>
                    _prevSysUser = sysUser;</p>
<p>                    _lastRun = DateTime.Now;</p>
<p>                    Monitor.Exit(_syncLock);<br>
                }<br>
            }<br>
            }</p>
<p>            return _cpuUsage;</p>
<p>This logic seems to work for the first iteration on the first 
process, but when it gets to the second process, it throws an error</p>
<p> “{“Object synchronization method was called from an unsynchronized 
block of code.”}”</p>
<p>Any idea how I can get around this? We are not locking anywhere to 
Exit out of the lock are we? Can you please help me out with this?</p>
<p>–Deekshit</p>
	</li>



	<li class="authcomment" id="comment-88211">

<div class="commentmetadata">
<strong><a href="http://www.philosophicalgeek.com/" rel="external 
nofollow" class="url">Ben</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-88211" title="">February
 25th, 2009 at 11:45 am</a> Said: 		</div>

<p>Deekshit, I think some important lines are missing from the code 
sample you posted. </p>
<p>However, I don’t think this approach is going to work with my code. 
The class stores the time values for a single process, which it needs in
 order to calculate cpu usage. </p>
<p>A better approach might be to have an array of CpuUsage objects, one 
for each process.</p>
<p>Also, you should check out the updated code samples–they use 
interlocked operations instead of locking, so they are much more 
efficient and performant now.</p>
	</li>



	<li class="alt" id="comment-88312">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-88312" title="">February
 26th, 2009 at 9:06 am</a> Said: 		</div>

<p>Hi Ben,</p>
<p>What do you mean by an array of CpuUsage objects for each process? 
How do I create a dynamic array of CpuUsage objects? I might want to 
monitor 1 process or 3 at anytime. Can you please help me out?</p>
<p>–Deekshit</p>
	</li>



	<li class="" id="comment-89421">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-89421" title="">March
 6th, 2009 at 4:00 am</a> Said: 		</div>

<p>CpuUsage[] usage = new CpuUsage[nProcs];</p>
<p>Is this what you are referring to Ben? I seem to be a bit lost here. 
Can you please help Ben?</p>
<p>Regards,<br>
Deekshit</p>
	</li>



	<li class="alt" id="comment-89422">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-89422" title="">March
 6th, 2009 at 4:11 am</a> Said: 		</div>

<p>I can get it to work if I create the CpuUsage objects in this way:</p>
<p>Assuming I want to monitor 2 processes</p>
<p>CpuUsage usage1 = new CpuUsage();<br>
CpuUsage usage2 = new CpuUsage();</p>
<p>and then I can run usage1.getUsage(procName[i]);<br>
and usage2.getUsage(procName[i+1]);</p>
<p>and this approach works, but is not dynamic at all..any tips on how I
 can get around this problem?</p>
<p>Regards,<br>
Deekshit</p>
	</li>



	<li class="authcomment" id="comment-89484">

<div class="commentmetadata">
<strong><a href="http://www.philosophicalgeek.com/" rel="external 
nofollow" class="url">Ben</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-89484" title="">March
 6th, 2009 at 12:15 pm</a> Said: 		</div>

<p>I think you have the right idea with the array.</p>
<p>CpuUsage[] usage = new CpuUsage[nProcs];<br>
for (int i=0;i<nprocs;i++) {="" int="" 
per="usage.GetUsage(procName[i]);" }=""></nprocs;i++)></p>
	</li>



	<li class="alt" id="comment-89929">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-89929" title="">March
 9th, 2009 at 9:45 am</a> Said: 		</div>

<p>Ben,</p>
<p>that approach doesnt work…<br>
usage[i] will never be initialized to any value. Trying to work on this 
further</p>
<p>–Deekshit</p>
	</li>



	<li class="" id="comment-91256">

<div class="commentmetadata">
<strong>Deekshit <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/in.png"
 alt="INDIA" title="INDIA" class="fs_flagicon" width="16" height="11"></strong>,
 on <a href="#comment-91256" title="">March 17th, 2009 at 2:39 pm</a> 
Said: 		</div>

<p>Hi Ben,</p>
<p>Any idea how to make this just one exe program so that I can copy the
 exe file to any machine and run the program?<br>
I havent been able to get past the objects problem, but I modified my 
program to accept command line arguments, so I’ll just put this into a 
batch file and run it.</p>
<p>Any ideas?</p>
<p>–Deekshit</p>
	</li>



	<li class="alt" id="comment-92797">

<div class="commentmetadata">
<strong><a href="http://csharp-codesamples.com/" rel="external nofollow"
 class="url">Rohan</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/in.png"
 alt="INDIA" title="INDIA" class="fs_flagicon" width="16" height="11"></strong>,
 on <a href="#comment-92797" title="">March 30th, 2009 at 1:43 pm</a> 
Said: 		</div>

<p>Good Article Ben</p>
	</li>



	<li class="" id="comment-95634">

<div class="commentmetadata">
<strong>Peter <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/nz.png"
 alt="NEW ZEALAND" title="NEW ZEALAND" class="fs_flagicon" width="16" 
height="11"></strong>, on <a href="#comment-95634" title="">April 20th, 
2009 at 5:29 pm</a> Said: 		</div>

<p>I have tried to run this program but always get entry point not fount
 GetTickCount64. I am using xp sp2 and tried to debug the source code 
from VS2008. do you know the reason?</p>
	</li>



	<li class="authcomment" id="comment-95729">

<div class="commentmetadata">
<strong><a href="http://www.philosophicalgeek.com/" rel="external 
nofollow" class="url">Ben</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-95729" title="">April
 21st, 2009 at 10:32 am</a> Said: 		</div>

<p>Peter, look at the documentation for this function on MSDN, 
specifically the requirements section: <a 
href="http://msdn.microsoft.com/en-us/library/ms724411.aspx" 
rel="nofollow">http://msdn.microsoft.com/en-us/library/ms724411.aspx</a></p>
	</li>



	<li class="alt" id="comment-101291">

<div class="commentmetadata">
<strong>bharath <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-101291" title="">May
 30th, 2009 at 6:36 pm</a> Said: 		</div>

<p>Hi Ben thats a great program, But how do I make it to monitor a 
particular process. I still didnot run the code but just want to make 
sure if we can monitor any process or not.</p>
<p>Thanks,<br>
Bharath</p>
	</li>



	<li class="" id="comment-101437">

<div class="commentmetadata">
<strong>bharath <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-101437" title="">May
 31st, 2009 at 3:01 pm</a> Said: 		</div>

<p>hi Ben, i tried building the solution it said it is successfull but i
 dont get any executable.</p>
	</li>



	<li class="alt" id="comment-101438">

<div class="commentmetadata">
<strong>bharath <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-101438" title="">May
 31st, 2009 at 3:02 pm</a> Said: 		</div>

<p>sorry got it working</p>
	</li>



	<li class="" id="comment-101439">

<div class="commentmetadata">
<strong>bharath <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-101439" title="">May
 31st, 2009 at 3:15 pm</a> Said: 		</div>

<p>Hi Ben, Sorry about the previous two messages but i am trying to use 
this program to monitor a particular process so I replaced 
GetCurrentProcess() by GetProcessesByName(“notepad”) but I am getting an
 error</p>
	</li>



	<li class="alt" id="comment-101444">

<div class="commentmetadata">
<strong>bharath <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-101444" title="">May
 31st, 2009 at 3:58 pm</a> Said: 		</div>

<p>‘GetProcessesByName’: identifier not found</p>
	</li>



	<li class="" id="comment-109582">

<div class="commentmetadata">
<strong>kao <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/vn.png"
 alt="VIET NAM" title="VIET NAM" class="fs_flagicon" width="16" 
height="11"></strong>, on <a href="#comment-109582" title="">August 2nd,
 2009 at 6:02 am</a> Said: 		</div>

<p>Hi Ben, I don’t understand every detail why you use thread method 
“EatItThreadProc”, and every thread method was used 2 times (in your 
code):</p>
<p>        static void Main(string[] args)<br>
        {<br>
            Console.WriteLine(“Input:”);<br>
            string processName = Console.ReadLine();<br>
            usage.setProcessName(processName);</p>
<p>            ThreadPool.QueueUserWorkItem(EatItThreadProc);<br>
            ThreadPool.QueueUserWorkItem(EatItThreadProc);</p>
<p>            ThreadPool.QueueUserWorkItem(WatchItThreadProc);<br>
            ThreadPool.QueueUserWorkItem(WatchItThreadProc);</p>
<p>            while (true)<br>
            {<br>
                Thread.Sleep(1000);<br>
            }<br>
        }</p>
<p>Can you explain for me?</p>
<p>Moreoverer, I try to compare your program and Task manager of Window,
 they have a little difference. So, your program ran exactly?</p>
<p>Thanks for your reply!</p>
	</li>



	<li class="authcomment" id="comment-109609">

<div class="commentmetadata">
<strong><a href="http://www.philosophicalgeek.com/" rel="external 
nofollow" class="url">Ben</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-109609" title="">August
 2nd, 2009 at 12:10 pm</a> Said: 		</div>

<p>That code is just test code to use the processor as much as possible,
 in multiple threads, in order to test the processor usage code.</p>
<p>I would not expect it to match task manager exactly–they are 
measuring the program at different times, so there will be a little 
difference. Over time, they should average out to the same, though.</p>
	</li>



	<li class="alt" id="comment-109665">

<div class="commentmetadata">
<strong>kao <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/vn.png"
 alt="VIET NAM" title="VIET NAM" class="fs_flagicon" width="16" 
height="11"></strong>, on <a href="#comment-109665" title="">August 2nd,
 2009 at 9:33 pm</a> Said: 		</div>

<p>Oh, I see. Thanks for the answer.  </p>
<p>p/s: Nice to meet you. <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/icon_smile.gif"
 alt=":)" class="wp-smiley"> </p>
	</li>



	<li class="" id="comment-134455">

<div class="commentmetadata">
<strong>Remy <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-134455" title="">March
 7th, 2010 at 3:50 pm</a> Said: 		</div>

<p>Hi Ben, </p>
<p>I wanted to use your program for my project, but the code uses 
GetSystemTimes() and GetTickCounts() which don’t seem to be supported by
 XP/2000.  Is there a quick fix for that?</p>
<p>Thanks ,<br>
Remy</p>
	</li>



	<li class="authcomment" id="comment-134571">

<div class="commentmetadata">
<strong><a href="http://www.philosophicalgeek.com/" rel="external 
nofollow" class="url">Ben</a> <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/us.png"
 alt="UNITED STATES" title="UNITED STATES" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-134571" title="">March
 8th, 2010 at 1:35 pm</a> Said: 		</div>

<p>Remy, GetTickCount() is supported by Windows 2000 (<a 
href="http://msdn.microsoft.com/en-us/library/ms724408%28VS.85" 
rel="nofollow">http://msdn.microsoft.com/en-us/library/ms724408(VS.85</a>).aspx),
 but GettickCount64 is not supported until Vista/2008.</p>
<p>For GetSystemTimes(), I think your only solution is to use the 
officially-unsupported function NtQuerySystemInformation  (<a 
href="http://msdn.microsoft.com/en-us/library/ms724509%28VS.85" 
rel="nofollow">http://msdn.microsoft.com/en-us/library/ms724509(VS.85</a>).aspx,
 look for SYSTEM_PROCESSOR_PERFORMANCE_INFORMATION). I would put usage 
of this inside some #ifdef so it’s only used in Windows 2000/XP, because
 this method could change or be removed in future versions of Windows.</p>
	</li>



	<li class="alt" id="comment-136057">

<div class="commentmetadata">
<strong>P.C. <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/cz.png"
 alt="CZECH REPUBLIC" title="CZECH REPUBLIC" class="fs_flagicon" 
width="16" height="11"></strong>, on <a href="#comment-136057" title="">March
 27th, 2010 at 12:33 pm</a> Said: 		</div>

<p>I would disagree to sentence “Kernel, User, and Idle sum to total 
time, which is approximately wall-time.”</p>
<p>Idle time returned from GetSystemTimes is most probably a part of the
 Kernel time. </p>
<p>GetProcessTimes returns Kernel time without any Idle time periods 
because they belong to a different process.</p>
<p>So, the calculation takes the Idle time into account but I would say,
 it is correct.</p>
	</li>


	</ol>




		<h3 id="respond">Leave a Reply</h3>


<form action="http://www.philosophicalgeek.com/wp-comments-post.php" 
method="post" id="commentform">

<p><input name="author" id="author" size="40" tabindex="1" type="text">
<label for="author"><small>Name (required)</small></label></p>

<p><input name="email" id="email" size="40" tabindex="2" type="text">
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input name="url" id="url" size="40" tabindex="3" type="text">
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags&#58; &lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </small></p>-->

<p><textarea name="comment" id="comment" cols="60" rows="10" 
tabindex="4"></textarea></p>

<p><input name="submit" id="submit" tabindex="5" value="Submit Comment" 
type="submit">
<input name="comment_post_ID" value="434" type="hidden">
</p>


</form>



			</div>

		</div><!-- End content for comments template -->

	</div></div><!-- End narrowcolumnwrapper and narrowcolumn classes for comments template -->
	</div><!-- End wrapper class -->

<!-- Start Sidebar -->

	<div class="sidebar">
<ul>
	
<li id="text-350506263" class="widget widget_text"><h2 
class="widgettitle">I wrote a book!</h2>
			<div class="textwidget"><iframe 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/cm.htm"
 style="width: 120px; height: 240px;" marginwidth="0" marginheight="0" 
frameborder="0" scrolling="no"></iframe>
</div>
		</li>
<li id="text-350506262" class="widget widget_text">			<div 
class="textwidget"><!-- Site search from Bing-->
<form method="get" action="http://www.bing.com/search">
<input name="cp" value="1252" type="hidden">
<input name="FORM" value="FREESS" type="hidden">
  <table bgcolor="#ffffff">
    <tbody><tr>
     <td>
        <input name="q" size="25" type="text">
</td></tr>
<tr><td>

        <a href="http://www.bing.com/">
          <img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/Logo_51x19_Dark.png"
 alt="Bing" border="0">
          </a><input value="Search Site" type="submit">
        <input name="q1" value="site:philosophicalgeek.com" 
type="hidden">
      </td>
    </tr>
  </tbody></table>
</form>
<!-- Site Search from Bing --></div>
		</li>
<li id="popular-posts" class="widget fs_popular_pages_widget"><h2 
class="widgettitle">Popular posts</h2>
	<ul>
		<li>
			<a title="My interview experience with Google" 
href="http://www.philosophicalgeek.com/2007/08/12/my-interview-experience-with-google/">My
 interview experience with Google</a>
		</li>

		<li>
			<a title="More on Google interview" 
href="http://www.philosophicalgeek.com/2007/08/14/more-on-google-interview/">More
 on Google interview</a>
		</li>

		<li>
			<a title="10 Ways to Learn New Things in Development" 
href="http://www.philosophicalgeek.com/2008/04/01/10-ways-to-learn-new-things-in-development/">10
 Ways to Learn New Things in Development</a>
		</li>

		<li>
			<a title="Visual Studio 2003 and 2005 Default Keyboard Shortcuts 
Cheat Sheet" 
href="http://www.philosophicalgeek.com/2006/11/02/visual-studio-2003-and-2005-default-keyboard-shortcuts-cheat-sheet/">Visual
 Studio 2003 and 2005 Default Keyboard Shortcuts Cheat Sheet</a>
		</li>

		<li>
			<a title="Determine CPU usage of current process (C++ and C#)" 
href="http://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/">Determine
 CPU usage of current process (C++ and C#)</a>
		</li>

		<li>
			<a title="4 Principles of Not Wasting Time" 
href="http://www.philosophicalgeek.com/2008/05/06/4-principles-of-not-wasting-time/">4
 Principles of Not Wasting Time</a>
		</li>

		<li>
			<a title="Threads in MFC II: Synchronization Objects" 
href="http://www.philosophicalgeek.com/2002/04/30/threads-in-mfc-ii-synchronization-objects/">Threads
 in MFC II: Synchronization Objects</a>
		</li>

		<li>
			<a title="Get a Free, Autographed Copy of C# 4.0 How-To!" 
href="http://www.philosophicalgeek.com/2010/05/10/get-a-free-autographed-copy-of-c-4-0-how-to/">Get
 a Free, Autographed Copy of C# 4.0 How-To!</a>
		</li>

		<li>
			<a title="My Interview Experience at Microsoft" 
href="http://www.philosophicalgeek.com/2008/08/10/my-interview-experience-at-microsoft/">My
 Interview Experience at Microsoft</a>
		</li>

		<li>
			<a title="Top 5 Attributes of Highly Effective Programmers" 
href="http://www.philosophicalgeek.com/2008/01/20/5-attributes-of-highly-effective-programmers/">Top
 5 Attributes of Highly Effective Programmers</a>
		</li>
	</ul>
</li>
		<li id="recent-posts-2" class="widget widget_recent_entries">		<h2 
class="widgettitle">Recent Posts</h2>
		<ul>
				<li><a 
href="http://www.philosophicalgeek.com/2010/05/10/get-a-free-autographed-copy-of-c-4-0-how-to/"
 title="Get a Free, Autographed Copy of C# 4.0 How-To!">Get a Free, 
Autographed Copy of C# 4.0 How-To! </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2010/03/19/interview-with-me/" 
title="Interview with Me">Interview with Me </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2010/03/12/blog-moving-hosts-this-weekend/"
 title="Blog moving hosts this weekend">Blog moving hosts this weekend </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2010/03/09/the-book-is-made-real/"
 title="The Book is Made Real">The Book is Made Real </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2010/03/08/c-4-0-how-to-available-now/"
 title="C# 4.0 How-To Available Now!">C# 4.0 How-To Available Now! </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/11/21/how-to-position-windows-correctly-at-120dpi-in-wpf/"
 title="How to position windows correctly at 120 DPI in WPF">How to 
position windows correctly at 120 DPI in WPF </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/11/16/a-wpf-numeric-entry-control/"
 title="A WPF Numeric Entry Control">A WPF Numeric Entry Control </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/11/03/review-the-code-book-the-most-entertaining-book-on-cryptography-youll-ever-read/"
 title="Review: The Code Book – the most entertaining book on 
cryptography you’ll ever read">Review: The Code Book – the most 
entertaining book on cryptography you’ll ever read </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/10/24/bing-lego-mosaic/" 
title="Bing LEGO mosaic">Bing LEGO mosaic </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/10/15/c-4-0-how-to-now-available-for-pre-sale/"
 title="C# 4.0 How-To now available for pre-sale!">C# 4.0 How-To now 
available for pre-sale! </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/10/07/lots-and-lots-of-tiles-2/"
 title="Lots, and lots of tiles">Lots, and lots of tiles </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/10/07/lots-and-lots-of-tiles/"
 title="Lots, and lots of tiles">Lots, and lots of tiles </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/10/02/brickcon-2009-this-weekendget-your-lego-fix-in-seattle/"
 title="BrickCon 2009 this weekend—get your LEGO fix in Seattle!">BrickCon
 2009 this weekend—get your LEGO fix in Seattle! </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/08/15/more-photos/" 
title="More Photos">More Photos </a></li>
				<li><a 
href="http://www.philosophicalgeek.com/2009/08/12/some-photos-of-pine-lake/"
 title="Some photos of Pine Lake">Some photos of Pine Lake </a></li>
				</ul>
		</li>
<li id="statistics" class="widget fs_widget"><h2 class="widgettitle">FireStats</h2>

<!-- You can customize the sidebox by playing with your theme css-->
<ul class="firestats_sidebox"> 
	<li>Pages displayed : <b>557432</b></li>
	<li>Unique visitors : <b>256463</b></li>
	<li>Pages displayed in last 24 hours : <b>1341</b></li>
	<li>Unique visitors in last 24 hours : <b>429</b></li>
	
</ul><span class="fs_powered_by"><img alt="FireStats icon" 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/firestats-icon-small.png"><a
 href="http://firestats.cc/">&nbsp;Powered by FireStats</a></span></li>
<li id="text-217402071" class="widget widget_text"><h2 
class="widgettitle">Blog Policy</h2>
			<div class="textwidget">This blog represents my own opinions and not 
those of my employer. This is my own personal work only.

All comments are moderated. Comments containing abusive language, 
profanity, or are wildly off-topic will not be approved.</div>
		</li>
<li id="text-4" class="widget widget_text"><h2 class="widgettitle">Feed</h2>
			<div class="textwidget"><p><a 
href="http://feeds.feedburner.com/PhilosophicalGeek" rel="alternate" 
type="application/rss+xml"><img 
src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/feed-icon16x16.png"
 alt="" style="vertical-align: middle; border: 0pt none;"></a>&nbsp;<a 
href="http://feeds.feedburner.com/PhilosophicalGeek" rel="alternate" 
type="application/rss+xml">Subscribe in a reader</a></p></div>
		</li>

 <li><h2>Meta</h2>
		<ul>
								</ul>
	</li>
</ul>



	</div>
<!-- End Sidebar -->
</div></div><!-- End pagewrapper and page classes -->

</div><!-- End container id -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3631517-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>

<script type="text/javascript">
jQuery(function() {
	
	jQuery.post("index.php",{ak_action:"api_record_view", ids: AKPC_IDS, type:"single"}, false, "json");
});
</script>
	<script type="text/javascript" src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/blogger.js"></script>
<script type="text/javascript" src="Philosophical%20Geek%20%C2%BB%20Determine%20CPU%20usage%20of%20current%20process%20%28C++%20and%20C%23%29_files/benmwatson"></script>
</body></html>