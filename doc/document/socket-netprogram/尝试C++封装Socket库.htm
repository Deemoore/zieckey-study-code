
<HTML>
  <HEAD>
    <title>CSDN技术中心 尝试用C++封装Socket库
    </title>
    <META NAME="MS.LOCALE" CONTENT="zh-CHS">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=gb2312">
    <meta name="MSHKeywordS" content="尝试用C++封装Socket库"/>
    <meta name="MSHKeywordK" content="CSDN"/>
    <meta name="MSHKeywordA" content="" />
    <meta name="Description" content="尝试用C++封装Socket库" />
    <meta name="Author" content="DanceFire" />
    <meta name="Search.PublishDate" content="Wed, 13 Oct 2004 01:16:00 GMT" />
    <meta name="Search.RevisedDate" content="" />
    <meta name="Search.TopicType" content="kbArticle" />
    <meta name="Search.UserRating" content="80%" />
    
    <link rel="stylesheet" href="/Skins/default/csdn.css" type="text/css">
  </HEAD>
  <body bgcolor="#ffffff" text="#000000" topmargin="0">
    <form name="Form1" method="post" action="readarticle.aspx?id=42487" id="Form1">
<input type="hidden" name="__VIEWSTATE" value="dDwtMTk0MzAyNTA0NDt0PDtsPGk8MD47aTwxPjs+O2w8dDw7bDxpPDE+O2k8OT47aTwxMT47aTwxMz47PjtsPHQ8cDxwPGw8V2lkdGg7SGVpZ2h0O18hU0I7PjtsPDE8XGU+OzE8XGU+O2k8Mzg0Pjs+Pjs+Ozs+O3Q8cDxwPGw8V2lkdGg7SGVpZ2h0O0NTRE5fQXJ0aWNsZUlEO0NTRE5fQXJ0aWNsZV9UaXRsZTtfIVNCOz47bDwxPFxlPjsxPFxlPjtpPDQyNDg3PjvlsJ3or5XnlKhDKyvlsIHoo4VTb2NrZXTlupM7aTwzODQ+Oz4+Oz47Oz47dDxwPHA8bDxXaWR0aDtIZWlnaHQ7Q1NETl9BcnRpY2xlSUQ7XyFTQjs+O2w8MTxcZT47MTxcZT47aTw0MjQ4Nz47aTwzODQ+Oz4+Oz47Oz47dDxwPHA8bDxXaWR0aDtIZWlnaHQ7XyFTQjs+O2w8MTxcZT47MTxcZT47aTwzODQ+Oz4+Oz47Oz47Pj47dDxwPHA8bDxXaWR0aDtIZWlnaHQ7XyFTQjs+O2w8MTxcZT47MTxcZT47aTwzODQ+Oz4+Oz47Oz47Pj47PuAPEHNCgj8+SouwP1eskv8oqmVJ" />

      
<!-- 头部双层导航栏040827 -->
<table width="955" height="3" border="0" align="center" cellpadding="0" cellspacing="0" bgcolor="#666666">
	<tr><td></td></tr>
</table>
<table width="955" border="0" align="center" cellpadding="0" cellspacing="0">
	<tr>
		<td width="192"><img height="75" src="/images/CSDN_Logo.gif" width="192"></td>
		<td width="542" background="/images/01_bg_01.gif">
			<table width="470" height="60" border="0" align="center" cellpadding="0" cellspacing="0" bordercolor="#000000" bgcolor="#FFFFFF">
				<tr>
					<td width="320">
					
<!--Begin//-->
<script type="text/javascript">
<!--
csdn_AD_Position_GroupID = "{f05ff3bf-246b-4d71-a101-b5d4ee3f6cd3}";
csdn_AD_Page_Url = document.location;
csdn_AD_CurrPage_CharSet = "gb2312";
//-->
</script>
<script type="text/javascript" src="http://ggmm.csdn.net/ggmm/Show_JavaScript.js" >
</script>
<!--End//-->
					
					</td>
<td>
<!--Begin//-->
		<script type="text/javascript">
<!--
csdn_AD_Position_GroupID = "{a07a8ddc-9f6e-4eaa-99f1-59e0c7a3a08b}";
csdn_AD_Page_Url = document.location;
csdn_AD_CurrPage_CharSet = "gb2312";
//-->
		</script>
		<script type="text/javascript" src="http://ggmm.csdn.net/ggmm/Show_JavaScript.js" >
		</script>
<!--End//-->
</td>


				</tr>
			</table>
		</td>
		<!--td width="221"><img src="/images/01_bg_02.gif" width="221" height="75"></td-->
	</tr>
</table>
<table width="955" border="0" align="center" cellpadding="0" cellspacing="0">
	<tr>
		<td style="PADDING-top: 4px;" width="510" background="/images/menu_bg.gif">
		&nbsp;&nbsp;<a href="http://www.csdn.net/" target="_blank">首 页</a>
		| <a href="http://www.csdn.net/news/" target="_blank">新 闻</a>
		| <a href="http://dev.csdn.net/">技术中心</a>
		| <a href="http://www.dearbook.com.cn/" target="_blank">第二书店</a>
		| <a href="http://www.csdn.net/magazine/" target="_blank">《程序员》</a>
		| <a href="http://www.csdn.net/CSDNMagazine/csdn_magazine.shtm" target="_blank">《开发高手》</a>
		| <a href="http://community.csdn.net/" target="_blank">社 区</a>
		| <a href="http://www.csdn.net/ypage/" target="_blank">黄 页</a>
		| <a href="http://www.csdn.net/commerce/#job" target="_blank">人 才</a>
		</td>
		<td width="59"><img src="/images/menu_1.gif" width="59" height="29"></td>
		<td width="386" align="left" valign="top" background="/images/menu_bg2.gif"><img src="/images/01_bg_03.gif" width="387" height="24"></td>
	</tr>
</table>
<table width="955" height="18" border="0" align="center" cellpadding="0" cellspacing="0" background="/images/title_buttom.gif" style="MARGIN-BOTTOM: 4px;">
	<tr> 
		<td height="22" align="center" valign="middle"><a href="http://www.csdn.net/mobile/" target="_blank">移 动</a>O<a href="http://www.csdn.net/subject/" target="_blank">专 题</a>O<a href="http://www.csdn.net/sun/" target="_blank">SUN</a>O<a href="http://www.csdn.net/ibmc/" target="_blank">IBM</a>O<a href="http://www.csdn.net/microsoft/" target="_blank">微 软</a>O<a href="http://www.csdn.net/wicresoft/" target="_blank">微 创</a>O<a href="http://www.csdn.net/prime/" target="_blank">精 华</a>O<a href="http://www.donews.com/" target="_blank">Donews</a>O<a href="http://www.csdn.net/ptpress/" target="_blank">人 邮</a></td>
	</tr>
</table>
<!-- /头部双层导航栏111111111111111 -->

      <TABLE id="Table1" height="161" cellSpacing="0" cellPadding="0" width="955" align="center"
        border="0">
        <TR>
          <TD vAlign="top" width="165" colspan="2">
            
<table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#000000">
	<tr>
		<td valign="top" bgcolor="#EDEDED">
			<table width="100%" cellpadding="0" cellspacing="0" border="0">
				<tr>
					<td height="27" align="right" background="/images/top.gif"><font class="fonttitle">我的技术中心&nbsp;</font></td>
				</tr>
			</table>
			<table width="100%" height="65" border="0" cellpadding="0" cellspacing="0">
				<tr align="center">
					<td><a href="http://www.csdn.net/Develop/MyClass/List_MyClass.asp">我的分类</a></td>
					<td><a href="http://www.csdn.net/Develop/My_Article.asp">我的文档</a></td>
				</tr>
                <tr align="center">
					<td><a href="/articlelist.aspx">全部文章</a></td>
					<td><a href="http://www.csdn.net/Develop/Add_Article.asp">发表文章</a></td>
				</tr>
				<tr align="center"> 
					<td><a href="http://www.csdn.net/develop/author/Edit_intro.asp">专栏管理</a></td>
					<td><a href="http://www.csdn.net/Develop/Help.shtm">使用说明</a></td>
				</tr>
			</table>
		</td>
	</tr>
</table>

			<br>
			<!-- Google 广告 -->
<script type="text/javascript"><!--
google_ad_client = "pub-1076724771190722";
google_ad_width = 125;
google_ad_height = 125;
google_ad_format = "125x125_as";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
			<br><br>
            
<table cellspacing="1" cellpadding="0" width="100%" border="0" bgcolor="#000000">
	<tr>
		<td valign="top" bgcolor="#F1F1F1">
			<table width="100%" cellpadding="0" cellspacing="0" border="0">
				<tr>
					<td height="27" align="right" background="/images/top.gif"><font class="fonttitle"><img src="/images/RSSIcon.gif" align="absmiddle" width="36" height="14">&nbsp;RSS 订阅&nbsp;</font></td>
				</tr>
			</table>
			<table width="100%" cellpadding="0" cellspacing="0" border="0">
				<tr>
					<td align="center" bgcolor="#FFFFFF"><a href="/articlelist.aspx">最新文档列表</a></td>
				</tr>
			</table>
			<table cellspacing="0" cellpadding="0" width="95%" border="0" style="margin-bottom: 4px;" align="center">
				<tr>
					<td align="right" style="border-bottom: 1px dashed #B0C4DE; color: #0033ff;"><font style="font-size: 8pt;">Windows/.NET</font></td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=14" >.NET</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=14">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=1" >Visual C++</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=1">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=2" >Delphi</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=2">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=3" >Visual Basic</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=3">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=4" >ASP</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=4">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=7" >JavaScript</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=7">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
			</table>
			<table cellspacing="0" cellpadding="0" width="95%" border="0" style="margin-bottom: 4px;" align="center">
				<tr>
					<td align="right" style="border-bottom: 1px dashed #B0C4DE; color: #0033ff;"><font style="font-size: 8pt;">Java/Linux</font></td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=6" >Java</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=6">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=5" >Perl</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=5">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
			</table>
			<table cellspacing="0" cellpadding="0" width="95%" border="0" style="margin-bottom: 4px;" align="center">
				<tr>
					<td align="right" style="border-bottom: 1px dashed #B0C4DE; color: #0033ff;"><font style="font-size: 8pt;">综合</font></td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=9" >其他开发语言</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=9">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=11" >文件格式</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=11">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
			</table>
			<table cellspacing="0" cellpadding="0" width="95%" border="0" style="margin-bottom: 4px;" align="center">
				<tr>
					<td align="right" style="border-bottom: 1px dashed #B0C4DE; color: #0033ff;"><font style="font-size: 8pt;">企业开发</font></td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=10" >游戏开发</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=10">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=12" >网站制作技术</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=12">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
			</table>
			<table cellspacing="0" cellpadding="0" width="95%" border="0" style="margin-bottom: 4px;" align="center">
				<tr>
					<td align="right" style="border-bottom: 1px dashed #B0C4DE; color: #0033ff;"><font style="font-size: 8pt;">数据库</font></td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=8" >数据库开发</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=8">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
			</table>
			<table cellspacing="0" cellpadding="0" width="95%" border="0" align="center">
				<tr>
					<td align="right" style="border-bottom: 1px dashed #B0C4DE; color: #0033ff;"><font style="font-size: 8pt;">软件工程</font></td>
				</tr>
				<tr>
					<td align="right"><a href="/articlelist.aspx?c=13" >其他</a>&nbsp;&nbsp;(<a href="http://www.csdn.net/Rss/RssFeed.aspx?rssid=1&bigclassid=13">rss</a>)&nbsp;&nbsp;&nbsp;&nbsp;</td>
				</tr>
			</table>
		</td>
	</tr>
</table>

            <br>
            
<table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="#000000">
	<tr>
		<td valign="top" bgcolor="#EDEDED">
			<table width="100%" cellpadding="0" cellspacing="0" border="0">
				<tr>
					<td height="27" align="right" background="/images/top.gif"><font class="fonttitle">积极原创作者&nbsp;</font></td>
				</tr>
			</table>
			<table width="100%" cellpadding="2" cellspacing="1" border="0">
			
					<tr><td align="right"><a href='/user/tellmenow'>tellmenow</a>&nbsp;<font color="#FF0000">(22)</font></td></tr>
				
					<tr><td align="right"><a href='/user/cutemouse'>cutemouse</a>&nbsp;<font color="#FF0000">(22)</font></td></tr>
				
					<tr><td align="right"><a href='/user/softj'>softj</a>&nbsp;<font color="#FF0000">(78)</font></td></tr>
				
					<tr><td align="right"><a href='/user/iiprogram'>iiprogram</a>&nbsp;<font color="#FF0000">(69)</font></td></tr>
				
					<tr><td align="right"><a href='/user/qdzx2008'>qdzx2008</a>&nbsp;<font color="#FF0000">(50)</font></td></tr>
				
					<tr><td align="right"><a href='/user/goodboy1881'>goodboy1881</a>&nbsp;<font color="#FF0000">(14)</font></td></tr>
				
					<tr><td align="right"><a href='/user/wangchinaking'>wangchinaking</a>&nbsp;<font color="#FF0000">(58)</font></td></tr>
				
					<tr><td align="right"><a href='/user/fancyhf'>fancyhf</a>&nbsp;<font color="#FF0000">(1)</font></td></tr>
				
					<tr><td align="right"><a href='/user/harrymeng'>harrymeng</a>&nbsp;<font color="#FF0000">(41)</font></td></tr>
				
					<tr><td align="right"><a href='/user/yjz0065'>yjz0065</a>&nbsp;<font color="#FF0000">(113)</font></td></tr>
				
			</table>
		</td>
	</tr>
</table>

          </TD>
          <TD vAlign="top" width="786">
            <table width="100%" border="0" cellpadding="4">
              <tr>
                <td width="10" height="19"></td>
                <td height="19">
<table width="100%" border="0" cellspacing="3" cellpadding="3">
  <tr>
    <td>
      <a href="http://www.csdn.net/">CSDN</a> - <a href="http://dev.csdn.net/">文档中心</a>
      - <font color="#003399">
        <a id="ArticleTitle1_ArticleTitle1_hlClass" href="/articlelist.aspx?c=9">其他开发语言
</a></font>
    </td>
    <TD align="right">
      阅读：<span id="ArticleTitle1_ArticleTitle1_lblReadCount">11030</span>
      &nbsp;&nbsp;评论：
      <span id="ArticleTitle1_ArticleTitle1_lblCommentCount">10</span>
      &nbsp;&nbsp; <a href="#Comment">参与评论</a>
    </TD>
  </tr>
</table>
<table width="100%" border="0" cellspacing="3" cellpadding="3" bgcolor="#eeeeee">
  <tr>
    <td width="60" height="0" nowrap></td>
    <td></td>
  </tr>
  <tr>
    <td height="16" align="center" nowrap bgcolor="#003399"><font color="#ffffff">标题</font></td>
    <td><b>&nbsp;
        <span id="ArticleTitle1_ArticleTitle1_lblTitle">尝试用C++封装Socket库</span></b>&nbsp;&nbsp;&nbsp;&nbsp;
        选择自 <a id="ArticleTitle1_ArticleTitle1_AuthorLink" href="/user/DanceFire">DanceFire</a> 的 Blog
    </td>
  </tr>
  <tr>
    <td height="16" align="center" bgcolor="#003399"><font color="#ffffff">关键字</font></td>
    <td width="500">&nbsp;
      <span id="ArticleTitle1_ArticleTitle1_lblKeywords">尝试用C++封装Socket库</span></td>
  </tr>
  <tr>
    <td height="16" align="center" bgcolor="#003399"><font color="#ffffff">出处</font></td>
    <td>&nbsp;
      <span id="ArticleTitle1_ArticleTitle1_lblSource"></span></td>
  </tr>
</table>
</td>
              </tr>
              <tr>
                <td width="10"></td>
                <td><span id="ArticleContent1_ArticleContent1_lblContent">这两天又看了几眼Socket编程，我老是没长性，总是东看看西看看。还老爱挑毛病，钻牛角尖，真是不可救药了。这不，又开始看Socket不顺眼了。当时是看了一个朋友给我的一段socket raw编程的代码，有一段看的我很恶心。如下：<BR><BR><FONT color=#007700>if((</FONT><FONT color=#0000bb>ErrorCode</FONT><FONT color=#007700>=</FONT><FONT color=#0000bb>WSAStartup</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>MAKEWORD</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>2</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>1</FONT><FONT color=#007700>),&amp;</FONT><FONT color=#0000bb>wsaData</FONT><FONT color=#007700>))!=</FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>){ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>printf</FONT><FONT color=#007700>(</FONT><FONT color=#dd0000>"WSAStartup failed: %d\n"</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>ErrorCode</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>2</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>sockMain</FONT><FONT color=#007700>=</FONT><FONT color=#0000bb>WSASocket</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>AF_INET</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>SOCK_RAW</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>IPPROTO_RAW</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>NULL</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>WSA_FLAG_OVERLAPPED</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;if(</FONT><FONT color=#0000bb>sockMain</FONT><FONT color=#007700>==</FONT><FONT color=#0000bb>INVALID_SOCKET</FONT><FONT color=#007700>) <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>printf</FONT><FONT color=#007700>(</FONT><FONT color=#dd0000>"Socket failed: %d\n"</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>WSAGetLastError</FONT><FONT color=#007700>()); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>3</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>ErrorCode</FONT><FONT color=#007700>=</FONT><FONT color=#0000bb>setsockopt</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>sockMain</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>IPPROTO_IP</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>IP_HDRINCL</FONT><FONT color=#007700>,(</FONT><FONT color=#0000bb>char </FONT><FONT color=#007700>*)&amp;</FONT><FONT color=#0000bb>flag</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>sizeof</FONT><FONT color=#007700>(int)); <BR>&nbsp;&nbsp;&nbsp;&nbsp;if(</FONT><FONT color=#0000bb>ErrorCode</FONT><FONT color=#007700>==</FONT><FONT color=#0000bb>SOCKET_ERROR</FONT><FONT color=#007700>) <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>printf</FONT><FONT color=#007700>(</FONT><FONT color=#dd0000>"Set sockopt failed: %d\n"</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>WSAGetLastError</FONT><FONT color=#007700>()); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>4</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>ErrorCode</FONT><FONT color=#007700>=</FONT><FONT color=#0000bb>setsockopt</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>sockMain</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>SOL_SOCKET</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>SO_SNDTIMEO</FONT><FONT color=#007700>,(</FONT><FONT color=#0000bb>char</FONT><FONT color=#007700>*)&amp;</FONT><FONT color=#0000bb>TimeOut</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>sizeof</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>TimeOut</FONT><FONT color=#007700>)); <BR>&nbsp;&nbsp;&nbsp;&nbsp;if(</FONT><FONT color=#0000bb>ErrorCode</FONT><FONT color=#007700>==</FONT><FONT color=#0000bb>SOCKET_ERROR</FONT><FONT color=#007700>) <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>printf</FONT><FONT color=#007700>(</FONT><FONT color=#dd0000>"Set sockopt time out failed: %d\n"</FONT><FONT color=#007700>,</FONT><FONT color=#0000bb>WSAGetLastError</FONT><FONT color=#007700>()); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>5</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR></FONT><FONT color=#0000bb></FONT><!-- php buffer end --><BR>也许很多人都觉得我神经，这个不是每个socket程序的必经之路么？要是觉得这个很难受破坏结构，那还怎么写大型的socket程序？也许吧，我说了我就是一个死脑筋，总喜欢看起来好一些东西。总觉得那种每一个函数调用后，就跟着一堆针对返回值得错误处理语句很罗嗦，为什么不用异常来使这些更优雅呢？代码上的优雅同时也就意味着代码的出错几率的降低。<BR><BR>再加上我对于孟岩他们所探讨的C++异常机制的怀疑还是无法深入理解。所以我打算尝试一下充分使用异常机制来完成类似上述代码得错误处理，用C++封装Winsock函数库，以后基于这个自己写的Socket C++类库，写一些通讯程序，从而暴露一些异常机制的弊病，让自己充分的理解异常机制的一些害处。现在我的理解还是太肤浅了，不够深入。<BR><BR>我现在的感觉是网络通讯中出现的异常简直太正常了，因为你无法预计将会发生什么，哪里会出错误，因此用异常机制去处理时非常合适的。而且我注意到很多地方的错误返回，又不少是错误发生后，确实没什么办法可以恢复的。所以，应该也不违背一些规则。试试看吧。<BR><BR>其实我本来是想找一个STL类似的类库，结果没找到。找到一个ACE结果把我给吓回去了，好大啊。没必要把。我只需要一个简单的用C++特性进行封装的Socket类库而已。如果有人听说了的话，请告诉我，省得我在这里白费力气。哦，不过也不白费力气，自己实现一些东西，挺好的。<BR><BR>我自己没读过STL代码，因此无法写出STL或者Boost风格的代码来，只能按照自我的想象，反复的调整代码了。不过通过封装一个类库，不断地debug，不断地完善，我对C++的理解一定会进一步的。也许那个时候我会说&#8220;哦？这是谁写的垃圾代码啊，简直不堪入目，愚蠢至极。。。wait，好像是我写的&#8221;然后就是羞愧至极。呵呵。<BR><BR>目前我实现了一个最简单的socket类库，准确说还不能叫做实现了一个类库，只能叫做用C++封装了几个socket函数而已，暂时只能叫做概念试验，但是我希望将来有一天这个能成长为一个比较简单、实用的C++ Socket类库。目前其中有3个类。<BR><FONT color=#007700>class </FONT><FONT color=#0000bb>NetException <BR></FONT><FONT color=#007700>{ <BR></FONT><FONT color=#0000bb>public</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>NetException</FONT><FONT color=#007700>(); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>NetException</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>int ErrorCode</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>NetException</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>string Message</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int msgId</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>virtual </FONT><FONT color=#007700>~</FONT><FONT color=#0000bb>NetException</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>string GetErrorMessage</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>dword ErrorCode</FONT><FONT color=#007700>) const; <BR></FONT><FONT color=#0000bb>protected</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>string m_Message</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int m_msgId</FONT><FONT color=#007700>; <BR></FONT><FONT color=#0000bb>public</FONT><FONT color=#007700>: <BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>string getMessage</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>m_Message</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int getId</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>m_msgId</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>}; <BR></FONT><FONT color=#0000bb><BR>NetException类是作为我所有异常的抛出类，如果有其他库需要的话，我会将此类作为基类以继承。<BR><BR><FONT color=#007700>class </FONT><FONT color=#0000bb>NetEnviroment <BR></FONT><FONT color=#007700>{ <BR></FONT><FONT color=#0000bb>public</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>NetEnviroment</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>NetEnviroment</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>byte bHighVersion</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>byte bLowVersion</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;~</FONT><FONT color=#0000bb>NetEnviroment</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>inline word MakeWord</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>byte wHigh</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>byte wLow</FONT><FONT color=#007700>) <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ((</FONT><FONT color=#0000bb>word</FONT><FONT color=#007700>)</FONT><FONT color=#0000bb>wHigh</FONT><FONT color=#007700>)&lt;&lt;</FONT><FONT color=#0000bb>8 </FONT><FONT color=#007700>| </FONT><FONT color=#0000bb>wLow</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>inline word getVersion</FONT><FONT color=#007700>() const <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>m_wsadata</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>wVersion</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>inline word getHigherVersion</FONT><FONT color=#007700>() const <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>m_wsadata</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>wHighVersion</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>inline string getDescription</FONT><FONT color=#007700>() const <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>string</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>m_wsadata</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>szDescription</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>inline string getSystemStatus</FONT><FONT color=#007700>() const <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </FONT><FONT color=#0000bb>string</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>m_wsadata</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>szSystemStatus</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR></FONT><FONT color=#0000bb>protected</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>WSADATA m_wsadata</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>bool&nbsp;&nbsp;&nbsp;&nbsp;m_bState</FONT><FONT color=#007700>; <BR></FONT><FONT color=#0000bb>public</FONT><FONT color=#007700>: <BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>void initial</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>byte high</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>byte low</FONT><FONT color=#007700>) <BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( </FONT><FONT color=#0000bb>WSAStartup</FONT><FONT color=#007700>( </FONT><FONT color=#0000bb>MakeWord</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>high</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>low</FONT><FONT color=#007700>), &amp;</FONT><FONT color=#0000bb>m_wsadata </FONT><FONT color=#007700>) != </FONT><FONT color=#0000bb>0 </FONT><FONT color=#007700>) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>throw NetException</FONT><FONT color=#007700>(); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>m_bState </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>true</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>}; <BR><BR>NetEnviroment是作为整个Socket的环境类。凡是使用网络的程序，只需要之前放置一个NetEnviroment对象，一切就Ok了，构造函数中调用了WSAStartup。析构函数中会调用WSACleanup()。<BR><BR><FONT color=#ff8000><BR></FONT><FONT color=#007700>class </FONT><FONT color=#0000bb>Socket <BR></FONT><FONT color=#007700>{ <BR></FONT><FONT color=#0000bb>public</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>Socket</FONT><FONT color=#007700>(); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>Socket</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>int protocol</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int type </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>SOCK_STREAM</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int af </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>AF_INET</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>Socket</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>SOCKET s</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int protocol </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>IPPROTO_TCP</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int type </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>SOCK_STREAM</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int af </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>AF_INET</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;~</FONT><FONT color=#0000bb>Socket</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>); <BR></FONT><FONT color=#0000bb>protected</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>SOCKET m_socket</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int m_af</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>m_type</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>m_protocol</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>m_port</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>SOCKADDR_IN m_remoteaddr</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;const static </FONT><FONT color=#0000bb>int BUF_SIZE </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>4096</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>bool m_Connected</FONT><FONT color=#007700>; <BR></FONT><FONT color=#0000bb>protected</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>void initSocket</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>int protocol </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>IPPROTO_TCP</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int type </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>SOCK_STREAM</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int af </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>AF_INET</FONT><FONT color=#007700>); <BR></FONT><FONT color=#0000bb>public</FONT><FONT color=#007700>: <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Bind</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>struct sockaddr</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>name</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int namelen</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Bind</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>word Port</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Listen</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>int backlog </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>SOMAXCONN</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>Socket Accept</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Connect</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>string hostname</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>word port</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Close</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Send</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>char</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>buf</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int len</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int flags </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Send</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>string message</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int flags </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int Receive</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>char</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>buf</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int len</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int flags </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>string Receive</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>int flags </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int SendTo</FONT><FONT color=#007700>(const </FONT><FONT color=#0000bb>char</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>buf</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int len</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>struct sockaddr</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>to</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int tolen</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int flags </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>int ReceiveFrom</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>char</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>buf</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int len</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>struct sockaddr</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>from</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>int</FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>fromlen</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>int flags </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>0</FONT><FONT color=#007700>); <BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>word getLocalPort</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>struct in_addr getLocalAddress</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>string getLocalAddressString</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>word getRemotePort</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>struct in_addr getRemoteAddress</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>string getRemoteAddressString</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>void</FONT><FONT color=#007700>) const; <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>struct sockaddr_in</FONT><FONT color=#007700>&amp; </FONT><FONT color=#0000bb>getSockName</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>SOCKET s </FONT><FONT color=#007700>= </FONT><FONT color=#0000bb>NULL</FONT><FONT color=#007700>) const; <BR>}; <BR><BR></FONT><FONT color=#0000bb>ostream</FONT><FONT color=#007700>&amp; </FONT><FONT color=#0000bb>operator </FONT><FONT color=#007700>&lt;&lt; ( </FONT><FONT color=#0000bb>ostream</FONT><FONT color=#007700>&amp; </FONT><FONT color=#0000bb>os</FONT><FONT color=#007700>, const </FONT><FONT color=#0000bb>Socket </FONT><FONT color=#007700>&amp;</FONT><FONT color=#0000bb>s </FONT><FONT color=#007700>); <BR></FONT><FONT color=#0000bb></FONT><!-- php buffer end --><BR>Socket类是真正干真家伙的类，这里面已经封装实现了很多基本的Socket函数。并且我的思想是尽量结合STL中的类型。因次我均使用STL中的string和Boost中的Regex。<BR><BR>基于这个类库，我写了一个获取我网站主页的代码，应该可以感觉到，代码异常简洁。<BR><BR><FONT color=#ff8000>#include "NetLib.h" <BR><BR></FONT><FONT color=#0000bb>NetEnviroment Env</FONT><FONT color=#007700>; <BR><BR></FONT><FONT color=#0000bb>int main</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>int argc</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>char </FONT><FONT color=#007700>* </FONT><FONT color=#0000bb>argv</FONT><FONT color=#007700>[]) <BR>{ <BR>&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>try</FONT><FONT color=#007700>{&nbsp;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>Socket client</FONT><FONT color=#007700>; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>client</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>Connect</FONT><FONT color=#007700>(</FONT><FONT color=#dd0000>"211.157.101.207"</FONT><FONT color=#007700>, </FONT><FONT color=#0000bb>80</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>client</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>Send</FONT><FONT color=#007700>(</FONT><FONT color=#dd0000>"GET / HTTP/1.1\r\nHost: www.dancefires.com\r\n\r\n"</FONT><FONT color=#007700>); <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>cout </FONT><FONT color=#007700>&lt;&lt; </FONT><FONT color=#0000bb>client</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>Receive</FONT><FONT color=#007700>() &lt;&lt; </FONT><FONT color=#0000bb>endl</FONT><FONT color=#007700>;&nbsp;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;}</FONT><FONT color=#0000bb>catch</FONT><FONT color=#007700>(</FONT><FONT color=#0000bb>NetException nerr</FONT><FONT color=#007700>){&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000bb>cerr</FONT><FONT color=#007700>&lt;&lt; </FONT><FONT color=#dd0000>"[" </FONT><FONT color=#007700>&lt;&lt; </FONT><FONT color=#0000bb>nerr</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>getId</FONT><FONT color=#007700>() &lt;&lt; </FONT><FONT color=#dd0000>"]&nbsp;&nbsp;&nbsp;&nbsp;" </FONT><FONT color=#007700>&lt;&lt; </FONT><FONT color=#0000bb>nerr</FONT><FONT color=#007700>.</FONT><FONT color=#0000bb>getMessage</FONT><FONT color=#007700>() &lt;&lt; </FONT><FONT color=#0000bb>endl</FONT><FONT color=#007700>;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;} <BR>} <BR></FONT><FONT color=#0000bb><BR>大家可以看到，用这个类库实现TCP&nbsp;Client是如此的简单，Send和Receive都是string(当然我也提供了，原始的[]的接口，呵呵，不然我就无法处理二进制流了。)。<BR><BR>NetLib.h是我做的C++封装的Socket库的头文件。我把NetEnviroment NetEnv放在了全局变量，实际上目的是为了让程序加载时，自动初始化NetEnv，并且调用WSAStartup()，初始化Socket堆栈。<BR><BR>连接、发送、接收，一气呵成，看起来确实很简洁明快。一旦有错误发生，便会有异常抛出，并被捕获，然后将异常的信息输出出来。这时突然一阵嘈杂的声音：&#8220;嘿！醒醒~~醒醒，别美了~~~这可离你说的Socket类库可差远了。&#8221; 嗯，以后有时间的话，我会逐步完善。一旦具有雏形，我会放到Open source社区去让它生长。不过目前，它远算不上是一个雏形。只能算是想法。还有太多太多的事情要去做&#8230;&#8230;</FONT><!-- php buffer end --></FONT><!-- php buffer end --></FONT><!-- php buffer end --></span>
<br />
<div style="font-size: 14px; line-height: 25px;"><strong>作者Blog：</strong><a id="ArticleContent1_ArticleContent1_AuthorBlogLink" href="http://blog.csdn.net/DanceFire/" target="_blank">http://blog.csdn.net/DanceFire/</a></div>
<div style="font-size: 14px; line-height: 25px; color:#900;"><strong>相关文章</strong></div>
<table id="ArticleContent1_ArticleContent1_RelatedArticles" cellspacing="0" border="0">
	<tr>
		<td>
    <a href="/article/80/80003.shtm">让我们用中文编程（二）之C++篇 - 自己做中文编程语言，你也行</a>
  </td>
	</tr><tr>
		<td>
    <a href="/article/42/42487.shtm">尝试用C++封装Socket库</a>
  </td>
	</tr><tr>
		<td>
    <a href="/article/40/40777.shtm">让我们用中文编程</a>
  </td>
	</tr><tr>
		<td>
    <a href="/article/40/40776.shtm">利用正则表达式将html网页数据变成Web Service</a>
  </td>
	</tr><tr>
		<td>
    <a href="/article/40/40774.shtm">Regular Expression 正则表达式-4 (C++) </a>
  </td>
	</tr>
</table>
</td>
              </tr>
            </table>
            <a name="#Comment"></a>
            <table width="100%" border="0" cellpadding="0">
              <tr>
                <td>
                  



  <table cellSpacing=0 cellPadding=0 width="100%" align=center bgColor=#006699 border=0>
    <tr bgColor=#006699>
      <td id=white align=center width=556 bgColor=#006699>
      <font color=#ffffff >对该文的评论</font> </td>
    </tr>
  </table>
  
    <table border="0" cellpadding="2" cellspacing="1" width="100%" align="center" bgcolor="#666666">
      <tr>
        <td colspan="3" bgcolor="#cccccc">
          <span style="color:#990000;">
            <img src="/images/ico_pencil.gif" hspace="1" height="16" width="16">
          </span>
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl0_lblUserName">CSDN 网友</span>
          <i>(
            <span id="CommnetList1_CommnetList1_rpCommentList__ctl0_lblPostTime">2005-04-04</span>)</i>
        </td>
      </tr>
      <tr>
        <td colspan="3" width="532" bgcolor="#ffffff">
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl0_lblContent">编写framework不是那么简单的，MFC封装的socket几乎不能用</span>
        </td>
      </tr>
    </table>
  
    <table border="0" cellpadding="2" cellspacing="1" width="100%" align="center" bgcolor="#666666">
      <tr>
        <td colspan="3" bgcolor="#cccccc">
          <span style="color:#990000;">
            <img src="/images/ico_pencil.gif" hspace="1" height="16" width="16">
          </span>
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl1_lblUserName">scdbz</span>
          <i>(
            <span id="CommnetList1_CommnetList1_rpCommentList__ctl1_lblPostTime">2005-02-18</span>)</i>
        </td>
      </tr>
      <tr>
        <td colspan="3" width="532" bgcolor="#ffffff">
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl1_lblContent">高效网络通信（服务）软件的体系结构是异常复杂的，不是这样简单的封装就能解决问题的。本文这种封装只能拿来玩玩，比如像作者这样获得自己网站的主页而已，一个高效而灵活的封装是必须要有复杂并行处理结构的，这也是像ACE这类封装的立足点和目标。本人一直以来都在持续开发一个网络SDK库，采用大规模缓存发送并行处理结构，基本可以把网络通信带宽发挥到极致，在100M局域网单Socket上双向通信可以达到13M字节/秒，每秒处理14万个上层应用提交的70个字节大小的小包，CPU利用率低于2％。现在这个库本人已用于网游的开发，能够轻松应付像网游服务器这类基于定时时钟处理的应用需求。</span>
        </td>
      </tr>
    </table>
  
    <table border="0" cellpadding="2" cellspacing="1" width="100%" align="center" bgcolor="#666666">
      <tr>
        <td colspan="3" bgcolor="#cccccc">
          <span style="color:#990000;">
            <img src="/images/ico_pencil.gif" hspace="1" height="16" width="16">
          </span>
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl2_lblUserName">CSDN 网友</span>
          <i>(
            <span id="CommnetList1_CommnetList1_rpCommentList__ctl2_lblPostTime">2005-01-26</span>)</i>
        </td>
      </tr>
      <tr>
        <td colspan="3" width="532" bgcolor="#ffffff">
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl2_lblContent">c++实现的socket可以参考gnu的项目Sockets，封装的比较好，开源项目，跨平台的，可以在windows，linux，BSD下使用。<br>
http://www.alhem.net/Sockets/</span>
        </td>
      </tr>
    </table>
  
    <table border="0" cellpadding="2" cellspacing="1" width="100%" align="center" bgcolor="#666666">
      <tr>
        <td colspan="3" bgcolor="#cccccc">
          <span style="color:#990000;">
            <img src="/images/ico_pencil.gif" hspace="1" height="16" width="16">
          </span>
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl3_lblUserName">hnet</span>
          <i>(
            <span id="CommnetList1_CommnetList1_rpCommentList__ctl3_lblPostTime">2005-01-06</span>)</i>
        </td>
      </tr>
      <tr>
        <td colspan="3" width="532" bgcolor="#ffffff">
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl3_lblContent">ace掌握起来虽然难&nbsp;但应用带来的简单、高效是值得的</span>
        </td>
      </tr>
    </table>
  
    <table border="0" cellpadding="2" cellspacing="1" width="100%" align="center" bgcolor="#666666">
      <tr>
        <td colspan="3" bgcolor="#cccccc">
          <span style="color:#990000;">
            <img src="/images/ico_pencil.gif" hspace="1" height="16" width="16">
          </span>
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl4_lblUserName">jacklondon</span>
          <i>(
            <span id="CommnetList1_CommnetList1_rpCommentList__ctl4_lblPostTime">2004-11-08</span>)</i>
        </td>
      </tr>
      <tr>
        <td colspan="3" width="532" bgcolor="#ffffff">
          <span id="CommnetList1_CommnetList1_rpCommentList__ctl4_lblContent">用&nbsp;log4cxx&nbsp;中的&nbsp;socket&nbsp;类吧。<br>
Log4cpp&nbsp;中的跨平台类库&nbsp;<br>
http://blog.csdn.net/jacklondon/archive/2004/09/23/114748.aspx</span>
        </td>
      </tr>
    </table>
  
<div align=right>
<a id="CommnetList1_CommnetList1_Morelink" href="http://comment.csdn.net/Comment.aspx?c=2&amp;s=42487">【评论】</a>
<a id="CommnetList1_CommnetList1_Hyperlink1" href="javascript:window.close();">【关闭】</a>
<a href="mailto:webmaster@csdn.net">【报告bug】</a>
</div>
<br>
                </td>
              </tr>
            </table>
          </TD>
        </TR>
      </TABLE>
    </form>
    
<!-- 版权 -->
<div align="center">
<script language="JavaScript" type="text/javascript" src="http://www.csdn.net/common/footer_gb.js"></script>
</div>
<!-- /版权 -->

    <script>
      document.write("<img src=http://count.csdn.net/count/pageview1.asp?columnid=4&itemid=11 border=0 width=0 height=0>");
    </script>
    <script>document.write("<img src=http://counter.csdn.net/pv.aspx?id=37 border=0 width=0 height=0>");</script>
  </body>
<script language="JavaScript" src="http://www.csdn.net/common/common.asp?cid=5"></script>
</HTML>
